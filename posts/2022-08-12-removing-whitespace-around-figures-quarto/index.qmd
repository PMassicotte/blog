---
title: "Removing white spaces around plots in R Markdown / Quarto"
author: "Philippe Massicotte"
date: "2022-08-12"
categories: [R, R tips]
# https://quarto.org/docs/websites/website-tools.html#preview-images
image: "img/preview.png" 
editor_options: 
  chunk_output_type: inline
draft: true
---

```{r setup}
#| include: false
library(sf)
library(ggplot2)
library(ggpmthemes)
library(rnaturalearth)
library(rnaturalearthdata)

theme_set(theme_minimal(base_family = "Montserrat"))

knitr::opts_chunk$set(dev.args = list(png = list(type = "cairo")))
```

When plotting spatial data, maintaining a proper aspect ratio is [important](https://www.pmassicotte.com/posts/2019-12-20-removing-borders-around-ggplot2-graphs/). If you save such plot in a file or embed it inside a R Markdown or a Quarto document, white spaces will appear around the plot to maintain the aspect ratio.

-   Need `magick` package.
-   Create a hook

![Let's crop something! Photo by <a href="https://unsplash.com/@rozetsky?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Ant Rozetsky</a> on <a href="https://unsplash.com/s/photos/crop?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>](img/preview.png){fig-alt="Close up on a grain field" fig-align="center"}

```{r get-data}
states <-
  ne_countries(
    country = "canada",
    returnclass = "sf",
    scale = "medium"
  )
```

If we plot...

-   We can see that there are white spaces around the image in order to keep the proper aspect ratio.

```{r plot-original}
#| echo: fenced
states |> 
  ggplot() +
  geom_sf(size = 0.25) + 
  coord_sf(crs = 2163) +
  theme(
    plot.background = element_rect(fill = "#3c3c3c"),
    panel.border = element_rect(color = "red", fill = NA),
    panel.grid = element_blank(),
    panel.background = element_rect(fill = "#3c3c3c", color = "red"),
    axis.text = element_blank(),
    axis.ticks = element_blank()
  )
```


```{r}
#| echo: fenced
knitr::knit_hooks$set(crop = knitr::hook_pdfcrop)
```

Using `crop: true` will

```{r plot-cropped}
#| echo: fenced
#| crop: true
states |> 
  ggplot() +
  geom_sf(size = 0.25) + 
  coord_sf(crs = 2163) +
  theme(
    plot.background = element_rect(fill = "#3c3c3c"),
    panel.border = element_rect(color = "red", fill = NA),
    panel.grid = element_blank(),
    panel.background = element_rect(fill = "#3c3c3c", color = "red"),
    axis.text = element_blank(),
    axis.ticks = element_blank()
  )
```

```{r}
plot(1)
```


<details>

<summary>Session info</summary>

```{r sessioninfo, echo = FALSE}
## Reproducibility info
options(width = 120)
devtools::session_info()
```

</details>
