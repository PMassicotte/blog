<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Philippe Massicotte">
<meta name="dcterms.date" content="2023-09-14">
<title>Philippe Massicotte - Unlocking Cloud Data: A Step-by-Step Guide to Reading and Transforming Spatial Data with DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HKD6ZGZGPY"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HKD6ZGZGPY', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Philippe Massicotte - Unlocking Cloud Data: A Step-by-Step Guide to Reading and Transforming Spatial Data with DuckDB">
<meta property="og:description" content="Numerical ecologist | Data visualization | R enthousiast">
<meta property="og:image" content="https://repository-images.githubusercontent.com/138754790/fdc92700-357b-11eb-9761-54b3c051137c">
<meta property="og:site_name" content="Just another R blog (Philippe Massicotte)">
<meta name="twitter:title" content="Philippe Massicotte - Unlocking Cloud Data: A Step-by-Step Guide to Reading and Transforming Spatial Data with DuckDB">
<meta name="twitter:description" content="Numerical ecologist | Data visualization | R enthousiast">
<meta name="twitter:image" content="https://repository-images.githubusercontent.com/138754790/fdc92700-357b-11eb-9761-54b3c051137c">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Philippe Massicotte</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../workshops.html"> 
<span class="menu-text">Workshops and teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pmassicotte"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/philmassicotte"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@philmassicotte"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../users/5558188/philippe-massicotte"> <i class="bi bi-stack-overflow" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Unlocking Cloud Data: A Step-by-Step Guide to Reading and Transforming Spatial Data with DuckDB</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Geospatial</div>
                <div class="quarto-category">DuckDB</div>
                <div class="quarto-category">Spatial</div>
                <div class="quarto-category">Simple Features</div>
                <div class="quarto-category">Parquet</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Philippe Massicotte </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 14, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#what-is-duckdb" id="toc-what-is-duckdb" class="nav-link active" data-scroll-target="#what-is-duckdb">What is DuckDB?</a></li>
  <li><a href="#create-a-duckdb-remote-connection" id="toc-create-a-duckdb-remote-connection" class="nav-link" data-scroll-target="#create-a-duckdb-remote-connection">Create a DuckDB remote connection</a></li>
  <li><a href="#data-wrangling-using-duckdb" id="toc-data-wrangling-using-duckdb" class="nav-link" data-scroll-target="#data-wrangling-using-duckdb">Data wrangling using DuckDB</a></li>
  <li>
<a href="#data-wrangling-using-dbplyr" id="toc-data-wrangling-using-dbplyr" class="nav-link" data-scroll-target="#data-wrangling-using-dbplyr">Data wrangling using dbplyr</a>
  <ul class="collapse">
<li><a href="#create-a-local-database" id="toc-create-a-local-database" class="nav-link" data-scroll-target="#create-a-local-database">Create a local database</a></li>
  </ul>
</li>
  <li>
<a href="#lets-go-spatial" id="toc-lets-go-spatial" class="nav-link" data-scroll-target="#lets-go-spatial">Letâ€™s go spatial ðŸš€ðŸš€ðŸš€</a>
  <ul class="collapse">
<li><a href="#querying-spatial-data" id="toc-querying-spatial-data" class="nav-link" data-scroll-target="#querying-spatial-data">Querying spatial data</a></li>
  </ul>
</li>
  <li><a href="#ressources" id="toc-ressources" class="nav-link" data-scroll-target="#ressources">Ressources</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>In this blog post, I will show you how to read and transform spatial data hosted in the cloud with <a href="https://duckdb.org/">DuckDB</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. I will use the <a href="https://github.com/tidyverse/nycflights13">nycflights13</a>, a popular dataset for learning <a href="https://r4ds.hadley.nz/">data science</a>. I will also use the <a href="https://github.com/r-spatial/sf/">sf</a> package to manipulate spatial data. We will first start our journey by using DuckDB to read tabular data from parquet files from an online repository. Then with <a href="https://github.com/tidyverse/dbplyr/">dbplyr</a> as a backbend, we will query the data. Then, with the help of the <a href="https://duckdb.org/docs/extensions/spatial">DuckDB spatial extension</a>, I will introduce how we can do geospatial processing within DuckDB and sf.</p>
<section id="what-is-duckdb" class="level2"><h2 class="anchored" data-anchor-id="what-is-duckdb">What is DuckDB?</h2>
<p>DuckDB is an embeddable SQL OLAP database management system designed for efficient data querying and manipulation. It excels in processing large datasets swiftly and is particularly adept at handling complex analytical tasks while offering the flexibility to seamlessly integrate with various data <a href="https://duckdb.org/docs/archive/0.8.1/data/overview">sources and formats</a>. DuckDB also comes with a set of <a href="https://duckdb.org/docs/extensions/overview">extensions</a>:</p>
<div class="cell">
<div class="cell-output-display">
<div id="idzhvggdfe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#idzhvggdfe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#idzhvggdfe thead, #idzhvggdfe tbody, #idzhvggdfe tfoot, #idzhvggdfe tr, #idzhvggdfe td, #idzhvggdfe th {
  border-style: none;
}

#idzhvggdfe p {
  margin: 0;
  padding: 0;
}

#idzhvggdfe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#idzhvggdfe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#idzhvggdfe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#idzhvggdfe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#idzhvggdfe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#idzhvggdfe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idzhvggdfe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#idzhvggdfe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#idzhvggdfe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#idzhvggdfe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#idzhvggdfe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#idzhvggdfe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#idzhvggdfe .gt_spanner_row {
  border-bottom-style: hidden;
}

#idzhvggdfe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#idzhvggdfe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#idzhvggdfe .gt_from_md > :first-child {
  margin-top: 0;
}

#idzhvggdfe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#idzhvggdfe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#idzhvggdfe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#idzhvggdfe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#idzhvggdfe .gt_row_group_first td {
  border-top-width: 2px;
}

#idzhvggdfe .gt_row_group_first th {
  border-top-width: 2px;
}

#idzhvggdfe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#idzhvggdfe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#idzhvggdfe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#idzhvggdfe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idzhvggdfe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#idzhvggdfe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#idzhvggdfe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#idzhvggdfe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#idzhvggdfe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idzhvggdfe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#idzhvggdfe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#idzhvggdfe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#idzhvggdfe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#idzhvggdfe .gt_left {
  text-align: left;
}

#idzhvggdfe .gt_center {
  text-align: center;
}

#idzhvggdfe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#idzhvggdfe .gt_font_normal {
  font-weight: normal;
}

#idzhvggdfe .gt_font_bold {
  font-weight: bold;
}

#idzhvggdfe .gt_font_italic {
  font-style: italic;
}

#idzhvggdfe .gt_super {
  font-size: 65%;
}

#idzhvggdfe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#idzhvggdfe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#idzhvggdfe .gt_indent_1 {
  text-indent: 5px;
}

#idzhvggdfe .gt_indent_2 {
  text-indent: 10px;
}

#idzhvggdfe .gt_indent_3 {
  text-indent: 15px;
}

#idzhvggdfe .gt_indent_4 {
  text-indent: 20px;
}

#idzhvggdfe .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="extension_name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">extension_name</th>
<th id="loaded" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">loaded</th>
<th id="installed" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">installed</th>
<th id="description" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">description</th>
<th id="aliases" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">aliases</th>
<th id="extension_version" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">extension_version</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">arrow</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">A zero-copy data integration between Apache Arrow and DuckDB</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">autocomplete</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for autocomplete in the shell</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">aws</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Provides features that depend on the AWS SDK</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">azure</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds a filesystem abstraction for Azure blob storage to DuckDB</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">excel</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for Excel-like format strings</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">fts</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for Full-Text Search Indexes</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">httpfs</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">TRUE</td>
<td class="gt_row gt_left" headers="description">Adds support for reading and writing files over a HTTP(S) connection</td>
<td class="gt_row gt_center" headers="aliases">http, https, s3</td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">iceberg</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for Apache Iceberg</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">icu</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for time zones and collations using the ICU library</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">inet</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for IP-related data types and functions</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">jemalloc</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Overwrites system allocator with JEMalloc</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">json</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for JSON operations</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">motherduck</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Enables motherduck integration with the system</td>
<td class="gt_row gt_center" headers="aliases">md</td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">mysql_scanner</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for connecting to a MySQL database</td>
<td class="gt_row gt_center" headers="aliases">mysql</td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">parquet</td>
<td class="gt_row gt_center" headers="loaded">TRUE</td>
<td class="gt_row gt_center" headers="installed">TRUE</td>
<td class="gt_row gt_left" headers="description">Adds support for reading and writing parquet files</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">postgres_scanner</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for connecting to a Postgres database</td>
<td class="gt_row gt_center" headers="aliases">postgres</td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">spatial</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">TRUE</td>
<td class="gt_row gt_left" headers="description">Geospatial extension that adds support for working with spatial data and functions</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">sqlite_scanner</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for reading and writing SQLite database files</td>
<td class="gt_row gt_center" headers="aliases">sqlite, sqlite3</td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">substrait</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds support for the Substrait integration</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="extension_name">tpcds</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds TPC-DS data generation and query support</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="extension_name">tpch</td>
<td class="gt_row gt_center" headers="loaded">FALSE</td>
<td class="gt_row gt_center" headers="installed">FALSE</td>
<td class="gt_row gt_left" headers="description">Adds TPC-H data generation and query support</td>
<td class="gt_row gt_center" headers="aliases"></td>
<td class="gt_row gt_right" headers="extension_version"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/img1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption>These ducklings hatched the same morning as this walk. They walked from their nest to the nearby pond, across neighbourhood streets</figcaption></figure>
</div>
<center>
Photo by <a href="https://unsplash.com/@tchompalov?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Vlad Tchompalov</a> on <a href="https://unsplash.com/photos/wt5Y8VY_0bA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>
</center>
</section><section id="create-a-duckdb-remote-connection" class="level2"><h2 class="anchored" data-anchor-id="create-a-duckdb-remote-connection">Create a DuckDB remote connection</h2>
<p>For the following example, I will work with the nycflights13 data saved in parquet file format and hosted inside S3 buckets. I will use the <a href="https://duckdb.org/docs/extensions/httpfs">httpfs</a> extension to read the data. The httpfs extension allows DuckDB to read data from remote HTTP(S) sources which is exactly what we need here to read that data from the cloud.</p>
<p>The first thing I need to do is to create a DuckDB connection using <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html">DBI::dbConnect()</a></code> and install the httpfs extension and load it.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org">DBI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a connection</span></span>
<span><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install the httpfs extension and load it</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"INSTALL httpfs; LOAD httpfs;"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a connection, we can start exploring the data! All tables are stored in <a href="https://en.wikipedia.org/wiki/Apache_Parquet">parquet files</a> and hosted in s3 buckets. Here are the links to the data:</p>
<ul>
<li><a href="https://nycflights13.s3.valeria.science/airlines/20230913T174717Z-23aeb/airlines.parquet">airlines</a></li>
<li>
<a href="https://nycflights13.s3.valeria.science/airports/20230913T174717Z-ec372/airports.parquet">airports</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
</li>
<li><a href="https://nycflights13.s3.valeria.science/flights/20230913T174716Z-3899c/flights.parquet">flights</a></li>
<li><a href="https://nycflights13.s3.valeria.science/planes/20230913T174717Z-b5438/planes.parquet">planes</a></li>
<li><a href="https://nycflights13.s3.valeria.science/weather/20230913T174717Z-01531/weather.parquet">weather</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/img2.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption>Iâ€™m <span class="citation" data-cites="eodiin">@eodiin</span> on Instagram</figcaption></figure>
</div>
<center>
Photo by <a href="https://unsplash.com/@odiin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Erik Odiin</a> on <a href="https://unsplash.com/photos/jbQvJx2EWnU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>
</center>
<p><br></p>
<p>I will start by reading the <code>flights</code> table using the <a href="https://duckdb.org/docs/sql/introduction">SQL</a> syntax. To do so, I will use the <code>read_parquet()</code> function from DuckDB to read the parquet file and return a DuckDB table. Then, I will use the <code>CREATE OR REPLACE TABLE</code> statement to create a new table called <code>flights</code> and store the data returned by <code>read_parquet()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"CREATE OR REPLACE TABLE flights as SELECT * FROM"</span>,</span>
<span>  <span class="st">"read_parquet('https://nycflights13.s3.valeria.science/flights/20230913T174716Z-3899c/flights.parquet')"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 336776</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify that the table was created by using the <code>SHOW ALL TABLES</code> statement.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW ALL TABLES;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 Ã— 6</span></span>
<span><span class="co">#&gt;   database schema name    column_names column_types temporary</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;   &lt;list&gt;       &lt;list&gt;       &lt;lgl&gt;    </span></span>
<span><span class="co">#&gt; 1 memory   main   flights &lt;chr [19]&gt;   &lt;chr [19]&gt;   FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can further explore the table by using the following statements.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"FROM flights LIMIT 10;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 Ã— 19</span></span>
<span><span class="co">#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  2013     1     1      517            515         2      830            819</span></span>
<span><span class="co">#&gt;  2  2013     1     1      533            529         4      850            830</span></span>
<span><span class="co">#&gt;  3  2013     1     1      542            540         2      923            850</span></span>
<span><span class="co">#&gt;  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span><span class="co">#&gt;  5  2013     1     1      554            600        -6      812            837</span></span>
<span><span class="co">#&gt;  6  2013     1     1      554            558        -4      740            728</span></span>
<span><span class="co">#&gt;  7  2013     1     1      555            600        -5      913            854</span></span>
<span><span class="co">#&gt;  8  2013     1     1      557            600        -3      709            723</span></span>
<span><span class="co">#&gt;  9  2013     1     1      557            600        -3      838            846</span></span>
<span><span class="co">#&gt; 10  2013     1     1      558            600        -2      753            745</span></span>
<span><span class="co">#&gt; # â„¹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW flights;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 19 Ã— 6</span></span>
<span><span class="co">#&gt;    column_name    column_type              null  key   default extra</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 year           INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  2 month          INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  3 day            INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  4 dep_time       INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  5 sched_dep_time INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  6 dep_delay      DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  7 arr_time       INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  8 sched_arr_time INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  9 arr_delay      DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 10 carrier        VARCHAR                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 11 flight         INTEGER                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 12 tailnum        VARCHAR                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 13 origin         VARCHAR                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 14 dest           VARCHAR                  YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 15 air_time       DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 16 distance       DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 17 hour           DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 18 minute         DOUBLE                   YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 19 time_hour      TIMESTAMP WITH TIME ZONE YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SUMMARIZE flights;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 19 Ã— 12</span></span>
<span><span class="co">#&gt;    column_name    column_type  min   max   approx_unique avg   std   q25   q50  </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 year           INTEGER      2013  2013              1 2013â€¦ 0.0   2013  2013 </span></span>
<span><span class="co">#&gt;  2 month          INTEGER      1     12               12 6.54â€¦ 3.41â€¦ 4     7    </span></span>
<span><span class="co">#&gt;  3 day            INTEGER      1     31               31 15.7â€¦ 8.76â€¦ 8     16   </span></span>
<span><span class="co">#&gt;  4 dep_time       INTEGER      1     2400           1317 1349â€¦ 488.â€¦ 905   1382 </span></span>
<span><span class="co">#&gt;  5 sched_dep_time INTEGER      106   2359           1023 1344â€¦ 467.â€¦ 909   1377 </span></span>
<span><span class="co">#&gt;  6 dep_delay      DOUBLE       -43.0 1301â€¦           533 12.6â€¦ 40.2â€¦ -5.0  -1.5â€¦</span></span>
<span><span class="co">#&gt;  7 arr_time       INTEGER      1     2400           1418 1502â€¦ 533.â€¦ 1098  1535 </span></span>
<span><span class="co">#&gt;  8 sched_arr_time INTEGER      1     2359           1155 1536â€¦ 497.â€¦ 1124  1570 </span></span>
<span><span class="co">#&gt;  9 arr_delay      DOUBLE       -86.0 1272â€¦           581 6.89â€¦ 44.6â€¦ -17.â€¦ -5.0â€¦</span></span>
<span><span class="co">#&gt; 10 carrier        VARCHAR      9E    YV               16 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 11 flight         INTEGER      1     8500           3908 1971â€¦ 1632â€¦ 557   1497 </span></span>
<span><span class="co">#&gt; 12 tailnum        VARCHAR      D942â€¦ N9EAâ€¦          4005 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 13 origin         VARCHAR      EWR   LGA               3 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 14 dest           VARCHAR      ABQ   XNA             105 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 15 air_time       DOUBLE       20.0  695.0           516 150.â€¦ 93.6â€¦ 82.1â€¦ 129.â€¦</span></span>
<span><span class="co">#&gt; 16 distance       DOUBLE       17.0  4983â€¦           210 1039â€¦ 733.â€¦ 508.â€¦ 865.â€¦</span></span>
<span><span class="co">#&gt; 17 hour           DOUBLE       1.0   23.0             20 13.1â€¦ 4.66â€¦ 8.99â€¦ 13.4â€¦</span></span>
<span><span class="co">#&gt; 18 minute         DOUBLE       0.0   59.0             60 26.2â€¦ 19.3â€¦ 7.98â€¦ 28.9â€¦</span></span>
<span><span class="co">#&gt; 19 time_hour      TIMESTAMP Wâ€¦ 2013â€¦ 2014â€¦          6865 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; # â„¹ 3 more variables: q75 &lt;chr&gt;, count &lt;dbl&gt;, null_percentage &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Good, we now have created a table, we can start querying it. Letâ€™s start by calculating the average delay per destination. I will show how to do it with both DuckDB and R.</p>
</section><section id="data-wrangling-using-duckdb" class="level2"><h2 class="anchored" data-anchor-id="data-wrangling-using-duckdb">Data wrangling using DuckDB</h2>
<p>I will use the <code>GROUP BY</code> statement to group the data by destination and then use the <code>AVG()</code> function to calculate the average delay and finally order the results with the <code>ORDER BY</code> clause.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  <span class="st">"SELECT dest, AVG(arr_delay) AS delay, COUNT(*) AS n</span></span>
<span><span class="st">  FROM flights GROUP BY dest ORDER BY delay DESC;"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df1</span></span>
<span><span class="co">#&gt; # A tibble: 105 Ã— 3</span></span>
<span><span class="co">#&gt;    dest   delay     n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 CAE   41.764   116</span></span>
<span><span class="co">#&gt;  2 TUL   33.660   315</span></span>
<span><span class="co">#&gt;  3 OKC   30.619   346</span></span>
<span><span class="co">#&gt;  4 JAC   28.095    25</span></span>
<span><span class="co">#&gt;  5 TYS   24.069   631</span></span>
<span><span class="co">#&gt;  6 MSN   20.196   572</span></span>
<span><span class="co">#&gt;  7 RIC   20.111  2454</span></span>
<span><span class="co">#&gt;  8 CAK   19.698   864</span></span>
<span><span class="co">#&gt;  9 DSM   19.006   569</span></span>
<span><span class="co">#&gt; 10 GRR   18.190   765</span></span>
<span><span class="co">#&gt; # â„¹ 95 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data-wrangling-using-dbplyr" class="level2"><h2 class="anchored" data-anchor-id="data-wrangling-using-dbplyr">Data wrangling using dbplyr</h2>
<p>If you prefer the syntax of <a href="https://dplyr.tidyverse.org/">dplyr</a> syntax, you can use it to query DuckDB. First, we need to pull the data using the <code>tbl()</code> <a href="https://dbplyr.tidyverse.org/reference/tbl.src_dbi.html">function</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tbl</span><span class="op">(</span><span class="va">conn</span>, <span class="st">"flights"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   table&lt;flights&gt; [?? x 19]</span></span>
<span><span class="co">#&gt; # Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-28-generic:R 4.4.0/:memory:]</span></span>
<span><span class="co">#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  2013     1     1      517            515         2      830            819</span></span>
<span><span class="co">#&gt;  2  2013     1     1      533            529         4      850            830</span></span>
<span><span class="co">#&gt;  3  2013     1     1      542            540         2      923            850</span></span>
<span><span class="co">#&gt;  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span><span class="co">#&gt;  5  2013     1     1      554            600        -6      812            837</span></span>
<span><span class="co">#&gt;  6  2013     1     1      554            558        -4      740            728</span></span>
<span><span class="co">#&gt;  7  2013     1     1      555            600        -5      913            854</span></span>
<span><span class="co">#&gt;  8  2013     1     1      557            600        -3      709            723</span></span>
<span><span class="co">#&gt;  9  2013     1     1      557            600        -3      838            846</span></span>
<span><span class="co">#&gt; 10  2013     1     1      558            600        -2      753            745</span></span>
<span><span class="co">#&gt; # â„¹ more rows</span></span>
<span><span class="co">#&gt; # â„¹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us something to work with using the <code>dplyr</code> syntax. We can now use the <code>group_by()</code> function to group the data by destination and then use the <code>summarize()</code> function to calculate the average delay and the number of flights per destination. Finally, we can use the <code>arrange()</code> function to order the results by delay. But before we get the results, we can show what is the SQL query that was generated with the <code>show_query()</code> function from the <a href="https://dbplyr.tidyverse.org/articles/sql.html">dbplyr</a> package.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tbl</span><span class="op">(</span><span class="va">conn</span>, <span class="st">"flights"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">show_query</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span><span class="co">#&gt; SELECT dest, COUNT(*) AS n, AVG(arr_delay) AS delay</span></span>
<span><span class="co">#&gt; FROM flights</span></span>
<span><span class="co">#&gt; GROUP BY dest</span></span>
<span><span class="co">#&gt; ORDER BY delay DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that it looks pretty similar to the SQL query we wrote earlier. Now, we can get the results by using the <code>collect()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">conn</span>, <span class="st">"flights"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df2</span></span>
<span><span class="co">#&gt; # A tibble: 105 Ã— 3</span></span>
<span><span class="co">#&gt;    dest   delay     n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 CAE   41.764   116</span></span>
<span><span class="co">#&gt;  2 TUL   33.660   315</span></span>
<span><span class="co">#&gt;  3 OKC   30.619   346</span></span>
<span><span class="co">#&gt;  4 JAC   28.095    25</span></span>
<span><span class="co">#&gt;  5 TYS   24.069   631</span></span>
<span><span class="co">#&gt;  6 MSN   20.196   572</span></span>
<span><span class="co">#&gt;  7 RIC   20.111  2454</span></span>
<span><span class="co">#&gt;  8 CAK   19.698   864</span></span>
<span><span class="co">#&gt;  9 DSM   19.006   569</span></span>
<span><span class="co">#&gt; 10 GRR   18.190   765</span></span>
<span><span class="co">#&gt; # â„¹ 95 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify that both data frames are the same.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="create-a-local-database" class="level3"><h3 class="anchored" data-anchor-id="create-a-local-database">Create a local database</h3>
<p>Up to now, we have been working with an in-memory database. This means that once we close R, all the data will be lost. But what if we want to work with a local database? Well, it is pretty easy to do. We just need to specify the path to the database file when we create our connection. We can also specify if we want to create a read-only database or not.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dbi.r-dbi.org">"DBI"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to start an in-memory database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span>, dbdir <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to use a database file (not shared between processes)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span>, dbdir <span class="op">=</span> <span class="st">"my-db.duckdb"</span>, read_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to use a database file (shared between processes)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span>, dbdir <span class="op">=</span> <span class="st">"my-db.duckdb"</span>, read_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="lets-go-spatial" class="level2"><h2 class="anchored" data-anchor-id="lets-go-spatial">Letâ€™s go spatial ðŸš€ðŸš€ðŸš€</h2>
<p>If you know the nycflights13 dataset, you have noticed that the <code>airports</code> table has a <code>lon</code> and <code>lat</code> columns. This means that we can use these columns to create a geometry column and do some geospatial processing. To do so, we will need to install the <a href="https://duckdb.org/docs/extensions/spatial">spatial extension</a> and load it. But first, letâ€™s create the <code>airports</code> table as we did for the <code>flights</code> table.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"CREATE OR REPLACE TABLE airports as SELECT * FROM"</span>,</span>
<span>  <span class="st">"read_parquet('https://nycflights13.s3.valeria.science/airports/20230913T174717Z-ec372/airports.parquet')"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">query</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1458</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify that we now have two tables.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW ALL TABLES;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 Ã— 6</span></span>
<span><span class="co">#&gt;   database schema name     column_names column_types temporary</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;    &lt;list&gt;       &lt;list&gt;       &lt;lgl&gt;    </span></span>
<span><span class="co">#&gt; 1 memory   main   airports &lt;chr [8]&gt;    &lt;chr [8]&gt;    FALSE    </span></span>
<span><span class="co">#&gt; 2 memory   main   flights  &lt;chr [19]&gt;   &lt;chr [19]&gt;   FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And also have a glimpse of the data.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW airports;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 Ã— 6</span></span>
<span><span class="co">#&gt;   column_name column_type null  key   default extra</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 faa         VARCHAR     YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 2 name        VARCHAR     YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 3 lat         DOUBLE      YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 4 lon         DOUBLE      YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 5 alt         DOUBLE      YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 6 tz          DOUBLE      YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 7 dst         VARCHAR     YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 8 tzone       VARCHAR     YES   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW airports;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   column_name column_type null  key default extra</span></span>
<span><span class="co">#&gt; 1         faa     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2        name     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3         lat      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4         lon      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5         alt      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6          tz      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7         dst     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8       tzone     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, this is a simple table with no geometry column. To create the geometry column, we first need to install the spatial extension and load it.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"INSTALL 'spatial'; LOAD 'spatial';"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is now the time to let the magic happen. I will create a new table <code>airports_sf</code> and use the <code>ST_asWKB()</code> function to create the <code>geometry</code> column. The <code>ST_asWKB()</code> function takes two arguments: the geometry type and the geometry column. In our case, we will use the <code>ST_Point()</code> function to create a point geometry from the <code>lon</code> and <code>lat</code> columns that are present in the <code>airports</code> table.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Here I am creating the geometry column, looks like it worked.</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  <span class="st">"CREATE OR REPLACE TABLE airports_sf AS SELECT *,</span></span>
<span><span class="st">  ST_asWKB(ST_Point(lon, lat)) as geometry, FROM airports;"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1458</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looks like it worked! There is a <code>geometry</code> column in the <code>airports_sf</code> table. We can verify that by using the <code>SHOW airports_sf;</code> statement.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SHOW airports_sf;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   column_name column_type null  key default extra</span></span>
<span><span class="co">#&gt; 1         faa     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2        name     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3         lat      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4         lon      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5         alt      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6          tz      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7         dst     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8       tzone     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9    geometry    WKB_BLOB  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="querying-spatial-data" class="level3"><h3 class="anchored" data-anchor-id="querying-spatial-data">Querying spatial data</h3>
<p>With the geometry created, we can now do some geospatial processing. Letâ€™s start by calculating the distance between the airports and a point located at longitude -100 and latitude 40. To do so, we will use the <code>ST_GeomFromWKB()</code> function to create a geometry from the geometry column. Finally, we will use the <code>ST_Distance()</code> function to calculate the distance between the airports and a point located at longitude -100 and latitude 40. We will order the results by decreasing distances. If we look at the <a href="https://duckdb.org/docs/extensions/spatial">extension</a> documentation, we note that the <code>ST_Distance</code> function operates on two geometry. However, the geometry column is of type WKB (well-known binary) and need to be converted to <code>geom</code> with <code>ST_GeomFromWKB()</code>. Finally, we can use the <code>ST_Distance()</code> function to calculate the distance between the airports and a point located at longitude -100 and latitude 40. <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html">dbSendQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SELECT faa, name,</span></span>
<span><span class="st">  st_distance(ST_Transform(ST_GeomFromWKB(geometry), 'EPSG:4326', 'EPSG:4326'),</span></span>
<span><span class="st">  ST_Transform(ST_Point(-100, 40), 'EPSG:4326', 'EPSG:4326')) as dist from</span></span>
<span><span class="st">  airports_sf ORDER BY dist DESC"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html">dbFetch</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,458 Ã— 3</span></span>
<span><span class="co">#&gt;    faa   name                    dist</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 ADK   Adak Airport          77.561</span></span>
<span><span class="co">#&gt;  2 GAM   Gambell Airport       75.568</span></span>
<span><span class="co">#&gt;  3 AKB   Atka Airport          75.206</span></span>
<span><span class="co">#&gt;  4 SYA   Eareckson As          75.196</span></span>
<span><span class="co">#&gt;  5 SVA   Savoonga Airport      74.366</span></span>
<span><span class="co">#&gt;  6 WAA   Wales Airport         72.756</span></span>
<span><span class="co">#&gt;  7 TNC   Tin City LRRS Airport 72.573</span></span>
<span><span class="co">#&gt;  8 PHO   Point Hope Airport    72.566</span></span>
<span><span class="co">#&gt;  9 SNP   St Paul Island        72.289</span></span>
<span><span class="co">#&gt; 10 LUR   Cape Lisburne Lrrs    72.141</span></span>
<span><span class="co">#&gt; # â„¹ 1,448 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is nice, is that it is possible to use <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code> from <code>sf</code> to read the data directly from DuckDB. To do so, we need to specify the connection the query (which columns from the table we want) and the geometry column.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">airports_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  query <span class="op">=</span> <span class="st">"SELECT * FROM airports_sf;"</span>,</span>
<span>  geometry_column <span class="op">=</span> <span class="st">"geometry"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">airports_sf</span></span>
<span><span class="co">#&gt; Simple feature collection with 1458 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -176.646 ymin: 19.72137 xmax: -42.89833 ymax: 72.27083</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    faa                           name      lat        lon  alt tz dst</span></span>
<span><span class="co">#&gt; 1  04G              Lansdowne Airport 41.13047  -80.61958 1044 -5   A</span></span>
<span><span class="co">#&gt; 2  06A  Moton Field Municipal Airport 32.46057  -85.68003  264 -6   A</span></span>
<span><span class="co">#&gt; 3  06C            Schaumburg Regional 41.98934  -88.10124  801 -6   A</span></span>
<span><span class="co">#&gt; 4  06N                Randall Airport 41.43191  -74.39156  523 -5   A</span></span>
<span><span class="co">#&gt; 5  09J          Jekyll Island Airport 31.07447  -81.42778   11 -5   A</span></span>
<span><span class="co">#&gt; 6  0A9 Elizabethton Municipal Airport 36.37122  -82.17342 1593 -5   A</span></span>
<span><span class="co">#&gt; 7  0G6        Williams County Airport 41.46731  -84.50678  730 -5   A</span></span>
<span><span class="co">#&gt; 8  0G7  Finger Lakes Regional Airport 42.88356  -76.78123  492 -5   A</span></span>
<span><span class="co">#&gt; 9  0P2   Shoestring Aviation Airfield 39.79482  -76.64719 1000 -5   U</span></span>
<span><span class="co">#&gt; 10 0S9          Jefferson County Intl 48.05381 -122.81064  108 -8   A</span></span>
<span><span class="co">#&gt;                  tzone                   geometry</span></span>
<span><span class="co">#&gt; 1     America/New_York POINT (-80.61958 41.13047)</span></span>
<span><span class="co">#&gt; 2      America/Chicago POINT (-85.68003 32.46057)</span></span>
<span><span class="co">#&gt; 3      America/Chicago POINT (-88.10124 41.98934)</span></span>
<span><span class="co">#&gt; 4     America/New_York POINT (-74.39156 41.43191)</span></span>
<span><span class="co">#&gt; 5     America/New_York POINT (-81.42778 31.07447)</span></span>
<span><span class="co">#&gt; 6     America/New_York POINT (-82.17342 36.37122)</span></span>
<span><span class="co">#&gt; 7     America/New_York POINT (-84.50678 41.46731)</span></span>
<span><span class="co">#&gt; 8     America/New_York POINT (-76.78123 42.88356)</span></span>
<span><span class="co">#&gt; 9     America/New_York POINT (-76.64719 39.79482)</span></span>
<span><span class="co">#&gt; 10 America/Los_Angeles POINT (-122.8106 48.05381)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that if you want to write the data to a local file without using, so we can reuse it later, you can use the <code>COPY</code> statement. Here I am writing the <code>airports_sf</code> table to a GeoJSON file. Note that I am using the <code>LAYER_CREATION_OPTIONS</code> to specify that I want to write the bounding box to the file.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"COPY  airports_sf TO '~/Desktop/airports_sf.geojson' WITH (FORMAT GDAL, DRIVER 'GeoJSON', LAYER_CREATION_OPTIONS 'WRITE_BBOX=YES')"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While I am there, why not visualize the data?</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dest_proj</span> <span class="op">&lt;-</span> <span class="st">"ESRI:102008"</span></span>
<span></span>
<span><span class="va">usa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"United States of America"</span>,</span>
<span>  returnclass <span class="op">=</span> <span class="st">"sf"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">dest_proj</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">airports_sf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>, y <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="va">dest_proj</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Finally, do not forget to close your connection!</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">conn</span>, disconnect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="ressources" class="level2"><h2 class="anchored" data-anchor-id="ressources">Ressources</h2>
<ul>
<li><a href="https://duckdb.org/docs/extensions/spatial" class="uri">https://duckdb.org/docs/extensions/spatial</a></li>
<li><a href="https://duckdb.org/2023/04/28/spatial.html" class="uri">https://duckdb.org/2023/04/28/spatial.html</a></li>
<li><a href="https://tech.marksblogg.com/duckdb-gis-spatial-extension.html" class="uri">https://tech.marksblogg.com/duckdb-gis-spatial-extension.html</a></li>
<li><a href="https://youtu.be/ZX5FdqzGT1E" class="uri">https://youtu.be/ZX5FdqzGT1E</a></li>
<li><a href="https://youtu.be/ljzpm3Mrw-I?list=PLIYcNkSjh-0ztvwoAp3GeW8HNSUSk_q3K" class="uri">https://youtu.be/ljzpm3Mrw-I?list=PLIYcNkSjh-0ztvwoAp3GeW8HNSUSk_q3K</a></li>
</ul>
<details><summary>
Session info
</summary><div class="cell">
<pre><code>#&gt; â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#&gt;  setting  value
#&gt;  version  R version 4.4.0 (2024-04-24)
#&gt;  os       Linux Mint 21.3
#&gt;  system   x86_64, linux-gnu
#&gt;  ui       X11
#&gt;  language en_CA:en
#&gt;  collate  en_CA.UTF-8
#&gt;  ctype    en_CA.UTF-8
#&gt;  tz       America/Montreal
#&gt;  date     2024-05-02
#&gt;  pandoc   2.9.2.1 @ /usr/bin/ (via rmarkdown)
#&gt; 
#&gt; â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#&gt;  ! package       * version date (UTC) lib source
#&gt;  P blob            1.2.4   2023-03-17 [?] RSPM
#&gt;  P cachem          1.0.8   2023-05-01 [?] RSPM
#&gt;  P class           7.3-22  2023-05-03 [?] CRAN (R 4.3.1)
#&gt;  P classInt        0.4-10  2023-09-05 [?] RSPM
#&gt;  P cli             3.6.2   2023-12-11 [?] RSPM
#&gt;  P codetools       0.2-19  2023-02-01 [?] CRAN (R 4.2.2)
#&gt;  P colorspace      2.1-0   2023-01-23 [?] RSPM
#&gt;  P DBI           * 1.2.2   2024-02-16 [?] RSPM
#&gt;  P dbplyr          2.5.0   2024-03-19 [?] RSPM
#&gt;  P devtools        2.4.5   2022-10-11 [?] RSPM (R 4.4.0)
#&gt;  P digest          0.6.35  2024-03-11 [?] RSPM
#&gt;  P dplyr         * 1.1.4   2023-11-17 [?] RSPM
#&gt;  P duckdb        * 0.10.2  2024-05-01 [?] CRAN (R 4.4.0)
#&gt;  P e1071           1.7-14  2023-12-06 [?] RSPM
#&gt;  P ellipsis        0.3.2   2021-04-29 [?] RSPM
#&gt;  P evaluate        0.23    2023-11-01 [?] RSPM
#&gt;  P extrafont       0.19    2023-01-18 [?] RSPM
#&gt;  P extrafontdb     1.0     2012-06-11 [?] RSPM
#&gt;  P fansi           1.0.6   2023-12-08 [?] RSPM
#&gt;  P farver          2.1.1   2022-07-06 [?] RSPM
#&gt;  P fastmap         1.1.1   2023-02-24 [?] RSPM
#&gt;  P forcats       * 1.0.0   2023-01-29 [?] RSPM
#&gt;  P fs              1.6.4   2024-04-25 [?] CRAN (R 4.4.0)
#&gt;  P generics        0.1.3   2022-07-05 [?] RSPM
#&gt;  P ggplot2       * 3.5.1   2024-04-23 [?] RSPM
#&gt;  P ggpmthemes    * 0.0.2   2024-04-25 [?] Github (pmassicotte/ggpmthemes@993d61e)
#&gt;  P glue            1.7.0   2024-01-09 [?] RSPM
#&gt;  P gt              0.10.1  2024-01-17 [?] RSPM
#&gt;  P gtable          0.3.5   2024-04-22 [?] RSPM
#&gt;  P hms             1.1.3   2023-03-21 [?] RSPM
#&gt;  P htmltools       0.5.8.1 2024-04-04 [?] RSPM
#&gt;  P htmlwidgets     1.6.4   2023-12-06 [?] RSPM
#&gt;  P httpuv          1.6.15  2024-03-26 [?] RSPM
#&gt;  P httr            1.4.7   2023-08-15 [?] RSPM
#&gt;  P jsonlite        1.8.8   2023-12-04 [?] RSPM
#&gt;  P KernSmooth      2.23-22 2023-07-10 [?] CRAN (R 4.3.1)
#&gt;  P knitr           1.46    2024-04-06 [?] RSPM
#&gt;  P later           1.3.2   2023-12-06 [?] RSPM
#&gt;  P lifecycle       1.0.4   2023-11-07 [?] RSPM
#&gt;  P lubridate     * 1.9.3   2023-09-27 [?] RSPM
#&gt;  P magrittr        2.0.3   2022-03-30 [?] RSPM
#&gt;  P memoise         2.0.1   2021-11-26 [?] RSPM
#&gt;  P mime            0.12    2021-09-28 [?] RSPM
#&gt;  P miniUI          0.1.1.1 2018-05-18 [?] RSPM (R 4.4.0)
#&gt;  P munsell         0.5.1   2024-04-01 [?] RSPM
#&gt;  P pillar          1.9.0   2023-03-22 [?] RSPM
#&gt;  P pkgbuild        1.4.4   2024-03-17 [?] RSPM (R 4.4.0)
#&gt;  P pkgconfig       2.0.3   2019-09-22 [?] RSPM
#&gt;  P pkgload         1.3.4   2024-01-16 [?] RSPM (R 4.4.0)
#&gt;  P processx        3.8.4   2024-03-16 [?] RSPM
#&gt;  P profvis         0.3.8   2023-05-02 [?] RSPM (R 4.4.0)
#&gt;  P promises        1.3.0   2024-04-05 [?] RSPM
#&gt;  P proxy           0.4-27  2022-06-09 [?] RSPM
#&gt;  P ps              1.7.6   2024-01-18 [?] RSPM
#&gt;  P purrr         * 1.0.2   2023-08-10 [?] RSPM
#&gt;  P quarto        * 1.4     2024-03-06 [?] RSPM
#&gt;  P R.cache         0.16.0  2022-07-21 [?] RSPM
#&gt;  P R.methodsS3     1.8.2   2022-06-13 [?] RSPM
#&gt;  P R.oo            1.26.0  2024-01-24 [?] RSPM
#&gt;  P R.utils         2.12.3  2023-11-18 [?] RSPM
#&gt;  P R6              2.5.1   2021-08-19 [?] RSPM
#&gt;  P Rcpp            1.0.12  2024-01-09 [?] RSPM
#&gt;  P readr         * 2.1.5   2024-01-10 [?] RSPM
#&gt;  P remotes         2.5.0   2024-03-17 [?] RSPM (R 4.4.0)
#&gt;  P renv            1.0.7   2024-04-11 [?] RSPM (R 4.4.0)
#&gt;  P rlang           1.1.3   2024-01-10 [?] RSPM
#&gt;  P rmarkdown       2.26    2024-03-05 [?] RSPM
#&gt;  P rnaturalearth * 1.0.1   2023-12-15 [?] RSPM
#&gt;  P rstudioapi      0.16.0  2024-03-24 [?] RSPM
#&gt;  P Rttf2pt1        1.3.12  2023-01-22 [?] RSPM
#&gt;  P sass            0.4.9   2024-03-15 [?] RSPM
#&gt;  P scales          1.3.0   2023-11-28 [?] RSPM
#&gt;  P sessioninfo     1.2.2   2021-12-06 [?] RSPM (R 4.4.0)
#&gt;  P sf            * 1.0-16  2024-03-24 [?] RSPM
#&gt;  P shiny           1.8.1.1 2024-04-02 [?] RSPM (R 4.4.0)
#&gt;  P stringi         1.8.3   2023-12-11 [?] RSPM
#&gt;  P stringr       * 1.5.1   2023-11-14 [?] RSPM
#&gt;  P styler        * 1.10.3  2024-04-07 [?] RSPM
#&gt;  P terra           1.7-71  2024-01-31 [?] RSPM
#&gt;  P tibble        * 3.2.1   2023-03-20 [?] RSPM
#&gt;  P tidyr         * 1.3.1   2024-01-24 [?] RSPM
#&gt;  P tidyselect      1.2.1   2024-03-11 [?] RSPM
#&gt;  P tidyverse     * 2.0.0   2023-02-22 [?] RSPM
#&gt;  P timechange      0.3.0   2024-01-18 [?] RSPM
#&gt;  P tzdb            0.4.0   2023-05-12 [?] RSPM
#&gt;  P units           0.8-5   2023-11-28 [?] RSPM
#&gt;  P urlchecker      1.0.1   2021-11-30 [?] RSPM (R 4.4.0)
#&gt;  P usethis         2.2.3   2024-02-19 [?] RSPM (R 4.4.0)
#&gt;  P utf8            1.2.4   2023-10-22 [?] RSPM
#&gt;  P vctrs           0.6.5   2023-12-01 [?] RSPM
#&gt;  P withr           3.0.0   2024-01-16 [?] RSPM
#&gt;  P xfun            0.43    2024-03-25 [?] RSPM
#&gt;  P xml2            1.3.6   2023-12-04 [?] RSPM
#&gt;  P xtable          1.8-4   2019-04-21 [?] RSPM (R 4.4.0)
#&gt;  P yaml            2.3.8   2023-12-11 [?] RSPM
#&gt; 
#&gt;  [1] /tmp/RtmpkDFLxI/renv-use-libpath-18824056e1c01e
#&gt;  [2] /tmp/RtmpkDFLxI/renv-sandbox
#&gt; 
#&gt;  P â”€â”€ Loaded and on-disk path mismatch.
#&gt; 
#&gt; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
</div>
</details>

</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>DuckDB preview image: https://archive.org/details/github.com-duckdb-duckdb_-_2022-08-11_05-54-07<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
<li id="fn2"><p>Note that the airports table had positive longitudes. It seems that they should all be negative, so I corrected them.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
<li id="fn3"><p>Note that we are using lat/lon data for the calculation whereas a projected coordinate reference system would be better suited.<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
</ol></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{massicotte2023,
  author = {Massicotte, Philippe},
  title = {Unlocking {Cloud} {Data:} {A} {Step-by-Step} {Guide} to
    {Reading} and {Transforming} {Spatial} {Data} with {DuckDB}},
  date = {2023-09-14},
  url = {https://www.pmassicotte.com/posts/2023-09-14-duckdb-parquet-spatial-s3},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-massicotte2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Massicotte, Philippe. 2023. <span>â€œUnlocking Cloud Data: A Step-by-Step
Guide to Reading and Transforming Spatial Data with DuckDB.â€</span>
September 14, 2023. <a href="https://www.pmassicotte.com/posts/2023-09-14-duckdb-parquet-spatial-s3">https://www.pmassicotte.com/posts/2023-09-14-duckdb-parquet-spatial-s3</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://utteranc.es/client.js" repo="pmassicotte/PMassicotte.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>