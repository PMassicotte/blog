{
  "hash": "4f2221a1b430e815a9b16c9cb5397635",
  "result": {
    "markdown": "---\ntitle: \"Removing white spaces around plots in R Markdown / Quarto\"\nauthor: \"Philippe Massicotte\"\ndate: \"2022-08-15\"\ncategories: [R, R tips]\n# https://quarto.org/docs/websites/website-tools.html#preview-images\nimage: \"img/preview.png\" \neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nWhen plotting spatial data, such as a geographical map, maintaining a proper aspect ratio is [important](https://www.pmassicotte.com/posts/2019-12-20-removing-borders-around-ggplot2-graphs/). Whereas `knitr::plot_crop()` works fine to crop a file, how can we do the same operation for a figure inside an R Markdown or a Quarto document? Thanks to `knitr`, this can be done with a [hook](https://yihui.org/knitr/hooks/).\n\n![Let's crop something! Photo by <a href=\"https://unsplash.com/@rozetsky?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Ant Rozetsky</a> on <a href=\"https://unsplash.com/s/photos/crop?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>](img/preview.png){fig-alt=\"Close up on a grain field\" fig-align=\"center\"}\n\nI will use the polygon of Greenland to illustrate the issue.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngreenland <-\n  ne_countries(\n    country = \"greenland\",\n    returnclass = \"sf\",\n    scale = \"medium\"\n  )\n\n# Find a proper projection\nproj <- as.numeric(crsuggest::suggest_crs(greenland)$crs_code[1])\nproj\n#> [1] 5922\n```\n:::\n\n\nIf we plot the map, we can see that there are white spaces around the image to keep the proper aspect ratio. This is not a problem per se, but one might be interested to fill up the ploting area with the actual plot.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r plot-original}}\ngreenland |>\n  ggplot() +\n  geom_sf(size = 0.25) +\n  coord_sf(crs = proj) +\n  theme(\n    plot.background = element_rect(fill = \"#3c3c3c\"),\n    panel.border = element_rect(color = \"red\", fill = NA),\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"#3c3c3c\", color = \"red\"),\n    axis.text = element_blank(),\n    axis.ticks = element_blank()\n  )\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-original-1.png)\n:::\n:::\n\n\nNow, I will create a hook named `crop` that is associated with the `knitr::hook_pdfcrop()` function.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nknitr::knit_hooks$set(crop = knitr::hook_pdfcrop)\n```\n````\n:::\n\n\n::: callout-note\nNote that the [magick package](https://github.com/ropensci/magick/) and probably the underlying [system library](https://imagemagick.org/) need to be installed on your system to crop images.\n:::\n\nWith that, we can use `crop: true` in a code chunk to call it and crop the displayed graph.\n\n\n::: {.cell crop='true'}\n\n````{.cell-code}\n```{{r plot-cropped}}\n#| crop: true\ngreenland |> \n  ggplot() +\n  geom_sf(size = 0.25) + \n  coord_sf(crs = proj) +\n  theme(\n    plot.background = element_rect(fill = \"#3c3c3c\"),\n    panel.border = element_rect(color = \"red\", fill = NA),\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"#3c3c3c\", color = \"red\"),\n    axis.text = element_blank(),\n    axis.ticks = element_blank()\n  )\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-cropped-1.png)\n:::\n:::\n\n\nVoilÃ  ğŸ‘, no more borders around the image.\n\n<details>\n\n<summary>Session info</summary>\n\n\n::: {.cell}\n\n```\n#> â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#>  setting  value\n#>  version  R version 4.2.1 (2022-06-23)\n#>  os       Linux Mint 21\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Montreal\n#>  date     2022-08-15\n#>  pandoc   2.18 @ /usr/lib/rstudio/bin/quarto/bin/tools/ (via rmarkdown)\n#> \n#> â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#>  ! package           * version date (UTC) lib source\n#>  P assertthat          0.2.1   2019-03-21 [?] RSPM\n#>  P base64enc           0.1-3   2015-07-28 [?] RSPM\n#>  P cachem              1.0.6   2021-08-19 [?] RSPM (R 4.2.0)\n#>  P callr               3.7.1   2022-07-13 [?] RSPM (R 4.2.1)\n#>  P class               7.3-20  2022-01-13 [?] RSPM (R 4.2.0)\n#>  P classInt            0.4-7   2022-06-10 [?] RSPM (R 4.2.0)\n#>  P cli                 3.3.0   2022-04-25 [?] RSPM (R 4.2.0)\n#>  P codetools           0.2-18  2020-11-04 [?] RSPM (R 4.2.0)\n#>  P colorspace          2.0-3   2022-02-21 [?] RSPM (R 4.2.0)\n#>  P crayon              1.5.1   2022-03-26 [?] RSPM (R 4.2.0)\n#>  P crosstalk           1.2.0   2021-11-04 [?] RSPM (R 4.2.0)\n#>  P crsuggest           0.4     2022-07-06 [?] RSPM (R 4.2.0)\n#>  P DBI                 1.1.3   2022-06-18 [?] RSPM (R 4.2.0)\n#>  P devtools            2.4.4   2022-07-20 [?] RSPM (R 4.2.0)\n#>  P digest              0.6.29  2021-12-01 [?] RSPM\n#>  P dplyr               1.0.9   2022-04-28 [?] RSPM (R 4.2.0)\n#>  P e1071               1.7-11  2022-06-07 [?] RSPM (R 4.2.0)\n#>  P ellipsis            0.3.2   2021-04-29 [?] RSPM\n#>  P evaluate            0.16    2022-08-09 [?] RSPM (R 4.2.1)\n#>  P extrafont           0.18    2022-04-12 [?] RSPM (R 4.2.0)\n#>  P extrafontdb         1.0     2012-06-11 [?] RSPM (R 4.2.0)\n#>  P fansi               1.0.3   2022-03-24 [?] RSPM (R 4.2.0)\n#>  P farver              2.1.1   2022-07-06 [?] RSPM (R 4.2.1)\n#>  P fastmap             1.1.0   2021-01-25 [?] RSPM\n#>  P fs                  1.5.2   2021-12-08 [?] RSPM\n#>  P generics            0.1.3   2022-07-05 [?] RSPM (R 4.2.1)\n#>  P ggplot2           * 3.3.6   2022-05-03 [?] RSPM (R 4.2.0)\n#>  P ggpmthemes        * 0.0.2   2022-08-08 [?] Github (pmassicotte/ggpmthemes@993d61e)\n#>  P glue                1.6.2   2022-02-24 [?] RSPM (R 4.2.0)\n#>  P gtable              0.3.0   2019-03-25 [?] RSPM\n#>  P htmltools           0.5.3   2022-07-18 [?] RSPM (R 4.2.1)\n#>  P htmlwidgets         1.5.4   2021-09-08 [?] RSPM (R 4.2.0)\n#>  P httpuv              1.6.5   2022-01-05 [?] RSPM (R 4.2.0)\n#>  P jsonlite            1.8.0   2022-02-22 [?] RSPM (R 4.2.0)\n#>  P KernSmooth          2.23-20 2021-05-03 [?] RSPM (R 4.2.0)\n#>  P knitr               1.39    2022-04-26 [?] RSPM (R 4.2.0)\n#>  P later               1.3.0   2021-08-18 [?] RSPM (R 4.2.0)\n#>  P lattice             0.20-45 2021-09-22 [?] RSPM (R 4.2.0)\n#>  P leafem              0.2.0   2022-04-16 [?] CRAN (R 4.2.0)\n#>  P leaflet             2.1.1   2022-03-23 [?] RSPM (R 4.2.0)\n#>  P lifecycle           1.0.1   2021-09-24 [?] RSPM\n#>  P magick              2.7.3   2021-08-18 [?] CRAN (R 4.2.0)\n#>  P magrittr            2.0.3   2022-03-30 [?] RSPM (R 4.2.0)\n#>  P mapview             2.11.0  2022-04-16 [?] CRAN (R 4.2.0)\n#>  P memoise             2.0.1   2021-11-26 [?] RSPM (R 4.2.0)\n#>  P mime                0.12    2021-09-28 [?] RSPM\n#>  P miniUI              0.1.1.1 2018-05-18 [?] RSPM (R 4.2.0)\n#>  P munsell             0.5.0   2018-06-12 [?] RSPM\n#>  P pillar              1.8.0   2022-07-18 [?] RSPM (R 4.2.1)\n#>  P pkgbuild            1.3.1   2021-12-20 [?] RSPM (R 4.2.0)\n#>  P pkgconfig           2.0.3   2019-09-22 [?] RSPM\n#>  P pkgload             1.3.0   2022-06-27 [?] RSPM (R 4.2.0)\n#>  P png                 0.1-7   2013-12-03 [?] RSPM (R 4.2.0)\n#>  P prettyunits         1.1.1   2020-01-24 [?] RSPM\n#>  P processx            3.7.0   2022-07-07 [?] RSPM (R 4.2.1)\n#>  P profvis             0.3.7   2020-11-02 [?] RSPM (R 4.2.0)\n#>  P promises            1.2.0.1 2021-02-11 [?] RSPM (R 4.2.0)\n#>  P proxy               0.4-27  2022-06-09 [?] RSPM (R 4.2.0)\n#>  P ps                  1.7.1   2022-06-18 [?] RSPM (R 4.2.0)\n#>  P purrr               0.3.4   2020-04-17 [?] RSPM\n#>  P R6                  2.5.1   2021-08-19 [?] RSPM\n#>  P raster              3.5-21  2022-06-27 [?] RSPM (R 4.2.0)\n#>  P Rcpp                1.0.9   2022-07-08 [?] RSPM (R 4.2.1)\n#>  P remotes             2.4.2   2021-11-30 [?] RSPM (R 4.2.0)\n#>    renv                0.15.5  2022-05-26 [1] RSPM (R 4.2.0)\n#>  P rlang               1.0.4   2022-07-12 [?] RSPM (R 4.2.1)\n#>  P rmarkdown           2.14    2022-04-25 [?] RSPM (R 4.2.0)\n#>  P rnaturalearth     * 0.1.0   2017-03-21 [?] RSPM (R 4.2.0)\n#>  P rnaturalearthdata * 0.2.0   2022-06-21 [?] Github (ropensci/rnaturalearthdata@352e548)\n#>  P rstudioapi          0.13    2020-11-12 [?] RSPM\n#>  P Rttf2pt1            1.3.10  2022-02-07 [?] RSPM (R 4.2.0)\n#>  P s2                  1.1.0   2022-07-18 [?] RSPM (R 4.2.0)\n#>  P satellite           1.0.4   2021-10-12 [?] CRAN (R 4.2.0)\n#>  P scales              1.2.0   2022-04-13 [?] RSPM (R 4.2.0)\n#>  P sessioninfo         1.2.2   2021-12-06 [?] RSPM (R 4.2.0)\n#>  P sf                * 1.0-8   2022-07-14 [?] RSPM (R 4.2.0)\n#>  P shiny               1.7.2   2022-07-19 [?] RSPM (R 4.2.1)\n#>  P sp                  1.5-0   2022-06-05 [?] RSPM (R 4.2.0)\n#>  P stringi             1.7.8   2022-07-11 [?] RSPM (R 4.2.1)\n#>  P stringr             1.4.0   2019-02-10 [?] RSPM\n#>  P terra               1.6-7   2022-08-07 [?] RSPM (R 4.2.1)\n#>  P tibble              3.1.8   2022-07-22 [?] RSPM (R 4.2.1)\n#>  P tidyselect          1.1.2   2022-02-21 [?] RSPM (R 4.2.0)\n#>  P units               0.8-0   2022-02-05 [?] RSPM (R 4.2.0)\n#>  P urlchecker          1.0.1   2021-11-30 [?] RSPM (R 4.2.0)\n#>  P usethis             2.1.6   2022-05-25 [?] RSPM (R 4.2.0)\n#>  P utf8                1.2.2   2021-07-24 [?] RSPM\n#>  P vctrs               0.4.1   2022-04-13 [?] RSPM (R 4.2.0)\n#>  P webshot             0.5.3   2022-04-14 [?] CRAN (R 4.2.0)\n#>  P withr               2.5.0   2022-03-03 [?] RSPM (R 4.2.0)\n#>  P wk                  0.6.0   2022-01-03 [?] RSPM (R 4.2.0)\n#>  P xfun                0.32    2022-08-10 [?] RSPM (R 4.2.1)\n#>  P xtable              1.8-4   2019-04-21 [?] RSPM (R 4.2.0)\n#>  P yaml                2.3.5   2022-02-21 [?] RSPM (R 4.2.0)\n#> \n#>  [1] /media/LaCie16TB/work/r-blog/renv/library/R-4.2/x86_64-pc-linux-gnu\n#>  [2] /usr/lib/R/library\n#> \n#>  P â”€â”€ Loaded and on-disk path mismatch.\n#> \n#> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n```\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}