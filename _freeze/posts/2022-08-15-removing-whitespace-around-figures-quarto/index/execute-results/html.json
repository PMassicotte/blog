{
  "hash": "ee5c774249f7affa16277639edfa4179",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Removing white spaces around plots in R Markdown / Quarto'\nauthor: 'Philippe Massicotte'\ndate: '2022-08-15'\ncategories: [R, R tips]\n# https://quarto.org/docs/websites/website-tools.html#preview-images\nimage: 'img/preview.png'\neditor_options:\n  chunk_output_type: console\n---\n\n\n\n\n\n\nWhen plotting spatial data, such as a geographical map, maintaining a proper aspect ratio is [important](https://www.pmassicotte.com/posts/2019-12-20-removing-borders-around-ggplot2-graphs/). Whereas `knitr::plot_crop()` works fine to crop a file, how can we do the same operation for a figure inside an R Markdown or a Quarto document? Thanks to `knitr`, this can be done with a [hook](https://yihui.org/knitr/hooks/).\n\n![Let's crop something! Photo by <a href=\"https://unsplash.com/@rozetsky?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Ant Rozetsky</a> on <a href=\"https://unsplash.com/s/photos/crop?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>](img/preview.png){fig-alt=\"Close up on a grain field\" fig-align=\"center\"}\n\nI will use the polygon of Greenland to illustrate the issue.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngreenland <-\n  ne_countries(\n    country = \"greenland\",\n    returnclass = \"sf\",\n    scale = \"medium\"\n  )\n\n# Find a proper projection\nproj <- as.numeric(crsuggest::suggest_crs(greenland)$crs_code[1])\nproj\n#> [1] 5922\n```\n:::\n\n\nIf we plot the map, we can see that there are white spaces around the image to keep the proper aspect ratio. This is not a problem per se, but one might be interested to fill up the ploting area with the actual plot.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r plot-original}}\ngreenland |>\n  ggplot() +\n  geom_sf(size = 0.25) +\n  coord_sf(crs = proj) +\n  theme(\n    plot.background = element_rect(fill = \"#3c3c3c\"),\n    panel.border = element_rect(color = \"red\", fill = NA),\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"#3c3c3c\", color = \"red\"),\n    axis.text = element_blank(),\n    axis.ticks = element_blank()\n  )\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-original-1.png)\n:::\n:::\n\n\nNow, I will create a hook named `crop` that is associated with the `knitr::hook_pdfcrop()` function.\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nknitr::knit_hooks$set(crop = knitr::hook_pdfcrop)\n```\n````\n:::\n\n\n::: callout-note\nNote that the [magick package](https://github.com/ropensci/magick/) and probably the underlying [system library](https://imagemagick.org/) need to be installed on your system to crop images.\n:::\n\nWith that, we can use `crop: true` in a code chunk to call it and crop the displayed graph.\n\n\n::: {.cell crop='true'}\n\n````{.cell-code}\n```{{r plot-cropped}}\n#| crop: true\ngreenland |>\n  ggplot() +\n  geom_sf(size = 0.25) +\n  coord_sf(crs = proj) +\n  theme(\n    plot.background = element_rect(fill = \"#3c3c3c\"),\n    panel.border = element_rect(color = \"red\", fill = NA),\n    panel.grid = element_blank(),\n    panel.background = element_rect(fill = \"#3c3c3c\", color = \"red\"),\n    axis.text = element_blank(),\n    axis.ticks = element_blank()\n  )\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-cropped-1.png)\n:::\n:::\n\n\nVoil√† üëç, no more borders around the image.\n\n<details>\n\n<summary>Session info</summary>\n\n\n::: {.cell}\n\n```\n#> ‚îÄ Session info ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n#>  setting  value\n#>  version  R version 4.4.0 (2024-04-24)\n#>  os       Linux Mint 21.3\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Montreal\n#>  date     2024-05-03\n#>  pandoc   2.9.2.1 @ /usr/bin/ (via rmarkdown)\n#> \n#> ‚îÄ Packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n#>  ! package           * version date (UTC) lib source\n#>  P base64enc           0.1-3   2015-07-28 [?] RSPM\n#>  P cachem              1.0.8   2023-05-01 [?] RSPM\n#>  P class               7.3-22  2023-05-03 [?] CRAN (R 4.3.1)\n#>  P classInt            0.4-10  2023-09-05 [?] RSPM\n#>  P cli                 3.6.2   2023-12-11 [?] RSPM\n#>  P codetools           0.2-19  2023-02-01 [?] CRAN (R 4.2.2)\n#>  P colorspace          2.1-0   2023-01-23 [?] RSPM\n#>  P crosstalk           1.2.1   2023-11-23 [?] RSPM\n#>  P crsuggest           0.4     2022-07-06 [?] RSPM\n#>  P DBI                 1.2.2   2024-02-16 [?] RSPM\n#>  P devtools            2.4.5   2022-10-11 [?] RSPM (R 4.4.0)\n#>  P digest              0.6.35  2024-03-11 [?] RSPM\n#>  P dplyr               1.1.4   2023-11-17 [?] RSPM\n#>  P e1071               1.7-14  2023-12-06 [?] RSPM\n#>  P ellipsis            0.3.2   2021-04-29 [?] RSPM\n#>  P evaluate            0.23    2023-11-01 [?] RSPM\n#>  P extrafont           0.19    2023-01-18 [?] RSPM\n#>  P extrafontdb         1.0     2012-06-11 [?] RSPM\n#>  P fansi               1.0.6   2023-12-08 [?] RSPM\n#>  P farver              2.1.1   2022-07-06 [?] RSPM\n#>  P fastmap             1.1.1   2023-02-24 [?] RSPM\n#>  P fs                  1.6.4   2024-04-25 [?] CRAN (R 4.4.0)\n#>  P generics            0.1.3   2022-07-05 [?] RSPM\n#>  P ggplot2           * 3.5.1   2024-04-23 [?] RSPM\n#>  P ggpmthemes        * 0.0.2   2024-04-25 [?] Github (pmassicotte/ggpmthemes@993d61e)\n#>  P glue                1.7.0   2024-01-09 [?] RSPM\n#>  P gtable              0.3.5   2024-04-22 [?] RSPM\n#>  P htmltools           0.5.8.1 2024-04-04 [?] RSPM\n#>  P htmlwidgets         1.6.4   2023-12-06 [?] RSPM\n#>  P httpuv              1.6.15  2024-03-26 [?] RSPM\n#>  P httr                1.4.7   2023-08-15 [?] RSPM\n#>  P jsonlite            1.8.8   2023-12-04 [?] RSPM\n#>  P KernSmooth          2.23-22 2023-07-10 [?] CRAN (R 4.3.1)\n#>  P knitr               1.46    2024-04-06 [?] RSPM\n#>  P later               1.3.2   2023-12-06 [?] RSPM\n#>  P lattice             0.22-6  2024-03-20 [?] RSPM (R 4.4.0)\n#>  P leafem              0.2.3   2023-09-17 [?] RSPM\n#>  P leaflet             2.2.2   2024-03-26 [?] RSPM\n#>  P lifecycle           1.0.4   2023-11-07 [?] RSPM\n#>  P magick            * 2.8.3   2024-02-18 [?] RSPM\n#>  P magrittr            2.0.3   2022-03-30 [?] RSPM\n#>  P mapview             2.11.2  2023-10-13 [?] RSPM\n#>  P memoise             2.0.1   2021-11-26 [?] RSPM\n#>  P mime                0.12    2021-09-28 [?] RSPM\n#>  P miniUI              0.1.1.1 2018-05-18 [?] RSPM (R 4.4.0)\n#>  P munsell             0.5.1   2024-04-01 [?] RSPM\n#>  P pillar              1.9.0   2023-03-22 [?] RSPM\n#>  P pkgbuild            1.4.4   2024-03-17 [?] RSPM (R 4.4.0)\n#>  P pkgconfig           2.0.3   2019-09-22 [?] RSPM\n#>  P pkgload             1.3.4   2024-01-16 [?] RSPM (R 4.4.0)\n#>  P png                 0.1-8   2022-11-29 [?] RSPM\n#>  P processx            3.8.4   2024-03-16 [?] RSPM\n#>  P profvis             0.3.8   2023-05-02 [?] RSPM (R 4.4.0)\n#>  P promises            1.3.0   2024-04-05 [?] RSPM\n#>  P proxy               0.4-27  2022-06-09 [?] RSPM\n#>  P ps                  1.7.6   2024-01-18 [?] RSPM\n#>  P purrr               1.0.2   2023-08-10 [?] RSPM\n#>  P quarto            * 1.4     2024-03-06 [?] RSPM\n#>  P R.cache             0.16.0  2022-07-21 [?] RSPM\n#>  P R.methodsS3         1.8.2   2022-06-13 [?] RSPM\n#>  P R.oo                1.26.0  2024-01-24 [?] RSPM\n#>  P R.utils             2.12.3  2023-11-18 [?] RSPM\n#>  P R6                  2.5.1   2021-08-19 [?] RSPM\n#>  P raster              3.6-26  2023-10-14 [?] RSPM\n#>  P Rcpp                1.0.12  2024-01-09 [?] RSPM\n#>  P remotes             2.5.0   2024-03-17 [?] RSPM (R 4.4.0)\n#>  P renv                1.0.7   2024-04-11 [?] RSPM (R 4.4.0)\n#>  P rlang               1.1.3   2024-01-10 [?] RSPM\n#>  P rmarkdown           2.26    2024-03-05 [?] RSPM\n#>  P rnaturalearth     * 1.0.1   2023-12-15 [?] RSPM\n#>  P rnaturalearthdata * 1.0.0   2024-02-09 [?] RSPM\n#>  P rstudioapi          0.16.0  2024-03-24 [?] RSPM\n#>  P Rttf2pt1            1.3.12  2023-01-22 [?] RSPM\n#>  P satellite           1.0.5   2024-02-10 [?] RSPM\n#>  P scales              1.3.0   2023-11-28 [?] RSPM\n#>  P sessioninfo         1.2.2   2021-12-06 [?] RSPM (R 4.4.0)\n#>  P sf                * 1.0-16  2024-03-24 [?] RSPM\n#>  P shiny               1.8.1.1 2024-04-02 [?] RSPM (R 4.4.0)\n#>  P sp                  2.1-4   2024-04-30 [?] CRAN (R 4.4.0)\n#>  P stringi             1.8.3   2023-12-11 [?] RSPM\n#>  P stringr             1.5.1   2023-11-14 [?] RSPM\n#>  P styler            * 1.10.3  2024-04-07 [?] RSPM\n#>  P terra               1.7-71  2024-01-31 [?] RSPM\n#>  P tibble              3.2.1   2023-03-20 [?] RSPM\n#>  P tidyselect          1.2.1   2024-03-11 [?] RSPM\n#>  P tinytex             0.50    2024-03-16 [?] RSPM\n#>  P units               0.8-5   2023-11-28 [?] RSPM\n#>  P urlchecker          1.0.1   2021-11-30 [?] RSPM (R 4.4.0)\n#>  P usethis             2.2.3   2024-02-19 [?] RSPM (R 4.4.0)\n#>  P utf8                1.2.4   2023-10-22 [?] RSPM\n#>  P vctrs               0.6.5   2023-12-01 [?] RSPM\n#>  P withr               3.0.0   2024-01-16 [?] RSPM\n#>  P xfun                0.43    2024-03-25 [?] RSPM\n#>  P xtable              1.8-4   2019-04-21 [?] RSPM (R 4.4.0)\n#>  P yaml                2.3.8   2023-12-11 [?] RSPM\n#> \n#>  [1] /tmp/Rtmp84z1b8/renv-use-libpath-25ad1961f0a959\n#>  [2] /tmp/Rtmp84z1b8/renv-sandbox\n#> \n#>  P ‚îÄ‚îÄ Loaded and on-disk path mismatch.\n#> \n#> ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n```\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}