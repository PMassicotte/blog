{
  "hash": "68caad2a9c8183abcb3251093c5d440e",
  "result": {
    "markdown": "---\ntitle: \"Hanukkah of data 2022\"\nauthor: \"Philippe Massicotte\"\ndate: \"2022-12-28\"\ncategories: [R, ...]\n# The preview file needs to be named preview.png\n# mogrify -format png preview.jpg\n# https://quarto.org/docs/websites/website-tools.html#preview-images\nimage: \"img/preview.png\" \neditor_options: \n  chunk_output_type: console\nformat: \n  html: \n    df-print: paged\n    toc: true\n---\n\n\n\n\n## Hanukkah of data 2022\n\nIf you are looking for some data science challenges, don't look anymore, [Hanukkah of Data](https://hanukkah.bluebird.sh/5783/) is there for you. You can think of it as similar to [Advent of Code](https://adventofcode.com/) but tailored toward data-oriented puzzles with *only* eight challenges. In this blog post, I will try to solve all the puzzles using R.\n\n![<a href=\"https://hanukkah.bluebird.sh/5783/\">Hanukkah of data 2022 </a>](img/preview.png){fig-alt=\"Close up on a grain field\" fig-align=\"center\"}\n\n## Getting the data\n\nThe first step of the challenge is to [get the data](https://hanukkah.bluebird.sh/5783/0/). The trick is that the data is contained in a password-protected zip file. The very first challenge is to find the password of the zip file. You have to find out the Hebrew year that corresponds to 2017-01-01. To do so, I simply used [this website](https://www.hebcal.com/converter?gd=1&gm=1&gy=2017&g2h=1) and found out that the password was 5777. With this information, let us download the compressed file and unzip it into a temporary folder.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://hanukkah.bluebird.sh/5783/noahs-csv.zip\"\n\ntd <- tempdir()\ntf <- tempfile(tmpdir = td, fileext = \".zip\")\n\ncurl::curl_download(url, destfile = tf)\n\nsystem(command = paste0(\"unzip -o -P 5777 \", tf, \" -d \", td))\n```\n:::\n\n\nIf we look at all the unzipped files, we can see it consists in four CSV files that we can import in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiles <- fs::dir_ls(td, glob = \"*.csv\")\n\nfiles\n#> /tmp/RtmpTITBzh/noahs-customers.csv    /tmp/RtmpTITBzh/noahs-orders.csv       \n#> /tmp/RtmpTITBzh/noahs-orders_items.csv /tmp/RtmpTITBzh/noahs-products.csv\n\ncustomers <- read_csv(files[str_detect(files, \"noahs-customers.csv\")])\norders_items <- read_csv(files[str_detect(files, \"noahs-orders_items.csv\")])\norders <- read_csv(files[str_detect(files, \"noahs-orders.csv\")])\nproducts <- read_csv(files[str_detect(files, \"noahs-products.csv\")])\n```\n:::\n\n\nAfter exploring the data, I have found out that there is one duplicated customer in `noahs-customers.csv`. Specifically, `customerid` should uniquely identify each customer. Let's remove this duplicated entry (more about that later).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers |>\n  janitor::get_dupes()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"customerid\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"address\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"citystatezip\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"birthdate\"],\"name\":[5],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"phone\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"dupe_count\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"4308\",\"2\":\"Travis Bartlett\",\"3\":\"2527B Adam Clayton Powell Jr Blvd\",\"4\":\"Manhattan, NY 10039\",\"5\":\"1942-07-22\",\"6\":\"929-906-5980\",\"7\":\"2\"},{\"1\":\"4308\",\"2\":\"Travis Bartlett\",\"3\":\"2527B Adam Clayton Powell Jr Blvd\",\"4\":\"Manhattan, NY 10039\",\"5\":\"1942-07-22\",\"6\":\"929-906-5980\",\"7\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n\ncustomers <- customers |>\n  distinct(customerid, .keep_all = TRUE)\n```\n:::\n\n\n## Explore the data\n\nTo explore the relationships across the different tables, I am using the [{dm}](https://dm.cynkra.com/index.html) R package. This was the first time using this package and it looks interesting if you work with relational databases. Let's create a `dm` object using the `dm()` function with the four data frame we have.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"dm\")\n# install.packages(\"DiagrammeR\")\nlibrary(dm)\n\nnoahs_dm <- dm(customers, orders_items, orders, products)\n\nnoahs_dm\n#> ── Metadata ────────────────────────────────────────────────────────────────────\n#> Tables: `customers`, `orders_items`, `orders`, `products`\n#> Columns: 19\n#> Primary keys: 0\n#> Foreign keys: 0\n```\n:::\n\n\nThen, we can specify the primary key of each table using the `dm_add_pk()` function. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnoahs_dm <- noahs_dm |>\n  dm_add_pk(customers, customerid) |>\n  dm_add_pk(orders, orderid) |>\n  dm_add_pk(products, sku)\n\nnoahs_dm\n#> ── Metadata ────────────────────────────────────────────────────────────────────\n#> Tables: `customers`, `orders_items`, `orders`, `products`\n#> Columns: 19\n#> Primary keys: 3\n#> Foreign keys: 0\n```\n:::\n\n\nOne condition to set up a primary key is that it must be unique. The `enum_pk_candidates()` function can be used to scan all values in a table and will determine if any variable is suitable to be used as a primary key. As we can see below, `customerid` in `noahs-customers.csv` is duplicated twice in the data. This is why I used the `distinct()` function earlier to remove the duplicated entry.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_csv(files[str_detect(files, \"noahs-customers.csv\")]) |>\n  enum_pk_candidates() |>\n  gt::gt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ysvwfghyow\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#ysvwfghyow .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ysvwfghyow .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ysvwfghyow .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ysvwfghyow .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ysvwfghyow .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ysvwfghyow .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ysvwfghyow .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ysvwfghyow .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ysvwfghyow .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ysvwfghyow .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ysvwfghyow .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ysvwfghyow .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ysvwfghyow .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysvwfghyow .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ysvwfghyow .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ysvwfghyow .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysvwfghyow .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ysvwfghyow .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysvwfghyow .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ysvwfghyow .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysvwfghyow .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ysvwfghyow .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysvwfghyow .gt_left {\n  text-align: left;\n}\n\n#ysvwfghyow .gt_center {\n  text-align: center;\n}\n\n#ysvwfghyow .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ysvwfghyow .gt_font_normal {\n  font-weight: normal;\n}\n\n#ysvwfghyow .gt_font_bold {\n  font-weight: bold;\n}\n\n#ysvwfghyow .gt_font_italic {\n  font-style: italic;\n}\n\n#ysvwfghyow .gt_super {\n  font-size: 65%;\n}\n\n#ysvwfghyow .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#ysvwfghyow .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ysvwfghyow .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ysvwfghyow .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ysvwfghyow .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ysvwfghyow .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ysvwfghyow .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\">columns</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\">candidate</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\">why</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_center\">customerid</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: 4308 (2)</td></tr>\n    <tr><td class=\"gt_row gt_center\">name</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: Jennifer Smith (8), James Williams (7), David Johnson (6), James Johnson (6), Lisa Smith (6), …</td></tr>\n    <tr><td class=\"gt_row gt_center\">address</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: 1 East River Pl (4), 12B Cooper Pl (3), 205 W 88th St (3), 1023 38th St (2), 1167A Lexington Ave (2), …</td></tr>\n    <tr><td class=\"gt_row gt_center\">citystatezip</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: Brooklyn, NY 11234 (121), Corona, NY 11368 (121), Bronx, NY 10467 (111), Brooklyn, NY 11236 (99), Brooklyn, NY 11211 (98), …</td></tr>\n    <tr><td class=\"gt_row gt_center\">birthdate</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: 1953-01-12 (5), 1970-04-15 (5), 1946-06-28 (4), 1949-11-16 (4), 1952-03-29 (4), …</td></tr>\n    <tr><td class=\"gt_row gt_center\">phone</td>\n<td class=\"gt_row gt_center\">FALSE</td>\n<td class=\"gt_row gt_left\">has duplicate values: 838-616-4951 (2), 929-906-5980 (2)</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nWe can now use the `dm_add_fk()` function to specify the foreign keys in each table. Basically, `dm_add_fk(orders_items, sku, products)` means that the `sky` variable/key is used to link the `orders_items` and `products` tables together.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnoahs_dm <- noahs_dm |>\n  dm_add_fk(orders_items, sku, products) |>\n  dm_add_fk(orders_items, orderid, orders) |>\n  dm_add_fk(orders, customerid, customers)\n\nnoahs_dm\n#> ── Metadata ────────────────────────────────────────────────────────────────────\n#> Tables: `customers`, `orders_items`, `orders`, `products`\n#> Columns: 19\n#> Primary keys: 3\n#> Foreign keys: 3\n```\n:::\n\n\nFinally, we can visualize all the relationships with `dm_draw()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnoahs_dm |>\n  dm_draw()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-a4874da199fd2bc75b26\" style=\"width:100%;height:406px;\" class=\"grViz html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a4874da199fd2bc75b26\">{\"x\":{\"diagram\":\"#data_model\\ndigraph {\\ngraph [rankdir=LR tooltip=\\\"Data Model\\\" ]\\n\\nnode [margin=0 fontcolor = \\\"#444444\\\" ]\\n\\nedge [color = \\\"#555555\\\", arrowsize = 1, ]\\n\\npack=true\\npackmode= \\\"node\\\"\\n\\n  \\\"customers\\\" [id = \\\"customers\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">customers<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"customerid\\\"><U>customerid<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"orders\\\" [id = \\\"orders\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">orders<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"orderid\\\"><U>orderid<\\/U><\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"customerid\\\">customerid<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"orders_items\\\" [id = \\\"orders_items\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">orders_items<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"orderid\\\">orderid<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"sku\\\">sku<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"products\\\" [id = \\\"products\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">products<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"sku\\\"><U>sku<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n\\\"orders\\\":\\\"customerid\\\"->\\\"customers\\\":\\\"customerid\\\" [id=\\\"orders_1\\\"]\\n\\\"orders_items\\\":\\\"orderid\\\"->\\\"orders\\\":\\\"orderid\\\" [id=\\\"orders_items_1\\\"]\\n\\\"orders_items\\\":\\\"sku\\\"->\\\"products\\\":\\\"sku\\\" [id=\\\"orders_items_2\\\"]\\n}\",\"config\":{\"engine\":null,\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nI am not going to use more of `dm` for the rest of this post, but I am sure there is a lot more to cover.\n\n## Puzzle 1: beehive\n\nFor this first puzzle, we have to find the phone number that matches the customer's last name. The first step consists in extracting customers' last names and filtering out to keep those with only 10 characters (the length of the phone numbers).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- customers |>\n  select(name, phone) |>\n  mutate(last_name = str_match(name, \"\\\\s{1}(\\\\S+)$\")[, 2]) |>\n  mutate(last_name_n = nchar(last_name)) |>\n  filter(last_name_n == 10)\n\ndf\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name_n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Stephanie Fitzgerald\",\"2\":\"631-259-0721\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Derek Mclaughlin\",\"2\":\"716-582-2269\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Kara Mccullough\",\"2\":\"716-251-2601\",\"3\":\"Mccullough\",\"4\":\"10\"},{\"1\":\"Carlos Harrington\",\"2\":\"646-638-4388\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Zachary Richardson\",\"2\":\"914-845-7900\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Jasmine Erica Fitzgerald\",\"2\":\"838-830-0751\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Danielle Cunningham\",\"2\":\"574-826-5545\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Sandra Cunningham\",\"2\":\"339-962-5223\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Vincent Richardson\",\"2\":\"838-426-4175\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Jennifer Fitzgerald\",\"2\":\"680-432-0703\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Catherine Cunningham\",\"2\":\"585-255-8804\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Donna Mclaughlin\",\"2\":\"315-936-9629\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Justin Williamson\",\"2\":\"585-319-1606\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Robert Richardson\",\"2\":\"212-967-4886\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Ronald Fitzgerald\",\"2\":\"914-933-2418\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Nicholas Harrington\",\"2\":\"619-365-2495\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Justin Montgomery\",\"2\":\"347-806-0476\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Susan Richardson\",\"2\":\"680-966-8681\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Adam Stephenson\",\"2\":\"315-927-8200\",\"3\":\"Stephenson\",\"4\":\"10\"},{\"1\":\"Gregory Williamson\",\"2\":\"607-237-4459\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Sarah Richardson\",\"2\":\"607-414-5579\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Haley Hutchinson\",\"2\":\"838-987-9757\",\"3\":\"Hutchinson\",\"4\":\"10\"},{\"1\":\"Cassandra Christine Strickland\",\"2\":\"315-951-9655\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Brett Fitzgerald\",\"2\":\"838-992-9104\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Craig Villarreal\",\"2\":\"838-967-2938\",\"3\":\"Villarreal\",\"4\":\"10\"},{\"1\":\"Daniel Richardson\",\"2\":\"631-919-6172\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Shirley Cunningham\",\"2\":\"516-484-4825\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Julie Richardson\",\"2\":\"516-592-0451\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Christina Washington\",\"2\":\"934-358-9907\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Jose Pennington\",\"2\":\"516-746-3599\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Thomas Cunningham\",\"2\":\"585-680-5465\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Jessica Harrington\",\"2\":\"315-968-8955\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Reginald Mclaughlin\",\"2\":\"516-515-8862\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Katelyn Williamson\",\"2\":\"928-273-5812\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Heather Fitzgerald\",\"2\":\"516-885-8878\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Bobby Washington\",\"2\":\"716-248-0761\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Sam Guttenberg\",\"2\":\"488-836-2374\",\"3\":\"Guttenberg\",\"4\":\"10\"},{\"1\":\"Stephen Strickland\",\"2\":\"352-925-1930\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Linda Strickland\",\"2\":\"716-511-6974\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Michael Cunningham\",\"2\":\"607-710-5511\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Joshua Richardson\",\"2\":\"516-506-0911\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Lori Cunningham\",\"2\":\"747-604-2474\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Robert Williamson\",\"2\":\"516-661-9736\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Michael Williamson\",\"2\":\"914-410-2998\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Sherry Villarreal\",\"2\":\"585-541-4832\",\"3\":\"Villarreal\",\"4\":\"10\"},{\"1\":\"Daniel Richardson\",\"2\":\"516-760-4244\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Tina Nancy Valenzuela\",\"2\":\"315-868-2836\",\"3\":\"Valenzuela\",\"4\":\"10\"},{\"1\":\"Rachel Richardson\",\"2\":\"212-778-9867\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Jacqueline Fitzgerald\",\"2\":\"619-950-2418\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Travis Montgomery\",\"2\":\"838-329-8506\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Tiffany Williamson\",\"2\":\"315-987-9829\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Jennifer Richardson\",\"2\":\"838-792-8965\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Heather Mclaughlin\",\"2\":\"631-824-5979\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Leah Williamson\",\"2\":\"717-649-1711\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Shannon Richardson\",\"2\":\"551-762-8882\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Kathryn Alexa Villarreal\",\"2\":\"516-617-4529\",\"3\":\"Villarreal\",\"4\":\"10\"},{\"1\":\"Angela Hutchinson\",\"2\":\"479-799-0667\",\"3\":\"Hutchinson\",\"4\":\"10\"},{\"1\":\"Susan Strickland\",\"2\":\"838-386-7615\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Justin Richardson\",\"2\":\"859-666-0379\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Karen Fitzgerald\",\"2\":\"212-982-7330\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Amy Richardson\",\"2\":\"212-994-6145\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Scott Cunningham\",\"2\":\"561-533-8982\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Denise Harrington\",\"2\":\"914-983-7773\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Karen Montgomery\",\"2\":\"516-419-8003\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Diana Julie Richardson\",\"2\":\"516-414-8871\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Emily Williamson\",\"2\":\"212-259-4245\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Matthew Williamson\",\"2\":\"516-949-1466\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Grant Villanueva\",\"2\":\"520-993-8624\",\"3\":\"Villanueva\",\"4\":\"10\"},{\"1\":\"Cameron Richardson\",\"2\":\"347-285-1744\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Kimberly Washington\",\"2\":\"747-428-3230\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Christopher Pennington\",\"2\":\"914-401-7876\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Lauren Pennington\",\"2\":\"838-326-7506\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Suzanne Pennington\",\"2\":\"803-211-2406\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Donald Richardson\",\"2\":\"516-630-6418\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Brad Cunningham\",\"2\":\"914-695-2198\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Paula Jennifer Strickland\",\"2\":\"585-467-2248\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Morgan Richardson\",\"2\":\"315-284-8375\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Jeffrey Cunningham\",\"2\":\"341-251-7114\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Catherine Washington\",\"2\":\"838-521-2494\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Mary Richardson\",\"2\":\"775-988-7150\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Kristen Fitzgerald\",\"2\":\"838-681-7629\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Jaime Montgomery\",\"2\":\"814-337-0943\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Joshua Livingston\",\"2\":\"845-917-5017\",\"3\":\"Livingston\",\"4\":\"10\"},{\"1\":\"Scott Livingston\",\"2\":\"585-996-6681\",\"3\":\"Livingston\",\"4\":\"10\"},{\"1\":\"Jeremiah Harrington\",\"2\":\"315-984-6442\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Amanda Washington\",\"2\":\"516-832-4615\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Jamie Cunningham\",\"2\":\"516-666-4372\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Allison Harrington\",\"2\":\"914-864-0192\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"David Harrington\",\"2\":\"646-336-9493\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Joshua Mclaughlin\",\"2\":\"315-550-8107\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Amanda Valenzuela\",\"2\":\"540-260-3617\",\"3\":\"Valenzuela\",\"4\":\"10\"},{\"1\":\"Daniel Richardson\",\"2\":\"315-329-4135\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Renee Mclaughlin\",\"2\":\"315-489-8767\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Penny Mclaughlin\",\"2\":\"972-885-2298\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Denise Mclaughlin\",\"2\":\"516-512-3996\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Amy Richardson\",\"2\":\"315-798-8120\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Becky Richardson\",\"2\":\"516-253-6776\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Susan Richardson\",\"2\":\"636-559-7393\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Ethan Richardson\",\"2\":\"510-699-6963\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Katherine Richardson\",\"2\":\"516-782-8061\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Mark Montgomery\",\"2\":\"838-375-8770\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Darren Williamson\",\"2\":\"347-629-3744\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Tammy Villarreal\",\"2\":\"918-639-3335\",\"3\":\"Villarreal\",\"4\":\"10\"},{\"1\":\"Jerry Richardson\",\"2\":\"516-436-0054\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Rodney Harrington\",\"2\":\"838-434-2920\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Alicia Harrington\",\"2\":\"305-333-9198\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Robert Washington\",\"2\":\"585-746-4509\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"George Richardson\",\"2\":\"315-523-3025\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Christine Peggy Fitzgerald\",\"2\":\"838-376-7634\",\"3\":\"Fitzgerald\",\"4\":\"10\"},{\"1\":\"Donna Montgomery\",\"2\":\"516-354-3090\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Sherry Cunningham\",\"2\":\"551-536-8225\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"William Richardson\",\"2\":\"914-240-8499\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Lauren Washington\",\"2\":\"631-538-5203\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Mary Washington\",\"2\":\"332-260-6147\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Emily Villanueva\",\"2\":\"702-890-2247\",\"3\":\"Villanueva\",\"4\":\"10\"},{\"1\":\"William Hutchinson\",\"2\":\"702-913-9808\",\"3\":\"Hutchinson\",\"4\":\"10\"},{\"1\":\"Emily Richardson\",\"2\":\"332-417-3586\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Melanie Mclaughlin\",\"2\":\"315-956-3299\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Michelle Harrington\",\"2\":\"219-297-8034\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Sharon Stephenson\",\"2\":\"212-828-4474\",\"3\":\"Stephenson\",\"4\":\"10\"},{\"1\":\"Michael Mclaughlin\",\"2\":\"619-563-4701\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Roger Montgomery\",\"2\":\"838-384-4176\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Latoya Hutchinson\",\"2\":\"840-558-6356\",\"3\":\"Hutchinson\",\"4\":\"10\"},{\"1\":\"Natalie Richardson\",\"2\":\"516-333-7214\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Kimberly Williamson\",\"2\":\"838-388-8704\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Cynthia Strickland\",\"2\":\"516-591-3045\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Devin Hutchinson\",\"2\":\"315-626-0208\",\"3\":\"Hutchinson\",\"4\":\"10\"},{\"1\":\"Ryan Livingston\",\"2\":\"516-854-8069\",\"3\":\"Livingston\",\"4\":\"10\"},{\"1\":\"Devin Montgomery\",\"2\":\"838-233-7601\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Brianna Stephenson\",\"2\":\"838-985-4234\",\"3\":\"Stephenson\",\"4\":\"10\"},{\"1\":\"Jackie Williamson\",\"2\":\"315-351-9260\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Kristina Livingston\",\"2\":\"385-504-0165\",\"3\":\"Livingston\",\"4\":\"10\"},{\"1\":\"Susan Richardson\",\"2\":\"315-362-6340\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Nathan Washington\",\"2\":\"516-582-3756\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Kenneth Richardson\",\"2\":\"516-848-2235\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Chad Williamson\",\"2\":\"516-568-8491\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Christopher Pennington\",\"2\":\"315-614-4656\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Frederick Cunningham\",\"2\":\"934-389-0549\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Alicia Williamson\",\"2\":\"332-998-1989\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"James Mclaughlin\",\"2\":\"838-758-8413\",\"3\":\"Mclaughlin\",\"4\":\"10\"},{\"1\":\"Kelly Washington\",\"2\":\"315-261-4567\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"Dorothy Strickland\",\"2\":\"408-239-5843\",\"3\":\"Strickland\",\"4\":\"10\"},{\"1\":\"Joel Williamson\",\"2\":\"917-690-9765\",\"3\":\"Williamson\",\"4\":\"10\"},{\"1\":\"Ashley Jessica Harrington\",\"2\":\"516-293-4728\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Maria Washington\",\"2\":\"315-521-5062\",\"3\":\"Washington\",\"4\":\"10\"},{\"1\":\"David Cunningham\",\"2\":\"838-400-7692\",\"3\":\"Cunningham\",\"4\":\"10\"},{\"1\":\"Gregory Richardson\",\"2\":\"516-645-2063\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Whitney Harrington\",\"2\":\"332-782-0468\",\"3\":\"Harrington\",\"4\":\"10\"},{\"1\":\"Laura Montgomery\",\"2\":\"631-858-5441\",\"3\":\"Montgomery\",\"4\":\"10\"},{\"1\":\"Charles Villarreal\",\"2\":\"838-942-1578\",\"3\":\"Villarreal\",\"4\":\"10\"},{\"1\":\"Kaitlin Richardson\",\"2\":\"516-495-5910\",\"3\":\"Richardson\",\"4\":\"10\"},{\"1\":\"Kristin Jessica Livingston\",\"2\":\"315-660-5892\",\"3\":\"Livingston\",\"4\":\"10\"},{\"1\":\"Patricia Pennington\",\"2\":\"754-454-8081\",\"3\":\"Pennington\",\"4\":\"10\"},{\"1\":\"Kelsey Harrington\",\"2\":\"914-581-9519\",\"3\":\"Harrington\",\"4\":\"10\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThen, I am creating a lookup table that matches letters to the numbers of a phone. With that, I convert each letter of the last name into a string and filter to keep the phone number that is equal to the last name.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphone_lut <- c(\n  \"a\" = 2,\n  \"b\" = 2,\n  \"c\" = 2,\n  \"d\" = 3,\n  \"e\" = 3,\n  \"f\" = 3,\n  \"g\" = 4,\n  \"h\" = 4,\n  \"i\" = 4,\n  \"j\" = 5,\n  \"k\" = 5,\n  \"l\" = 5,\n  \"m\" = 6,\n  \"n\" = 6,\n  \"o\" = 6,\n  \"p\" = 7,\n  \"q\" = 7,\n  \"r\" = 7,\n  \"s\" = 7,\n  \"t\" = 8,\n  \"u\" = 8,\n  \"v\" = 8,\n  \"w\" = 9,\n  \"x\" = 9,\n  \"y\" = 9,\n  \"z\" = 9\n)\n\ndf |>\n  mutate(phone = str_remove_all(phone, \"-\")) |>\n  mutate(\n    number =\n      map_chr(str_split(tolower(last_name), \"\"), \n      \\(x) paste0(phone_lut[x], collapse = \"\"))\n  ) |>\n  filter(phone == number)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name_n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"number\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Sam Guttenberg\",\"2\":\"4888362374\",\"3\":\"Guttenberg\",\"4\":\"10\",\"5\":\"4888362374\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Puzzle 2: snail\n\nThe first step is to extract customer initials and only keep \"JD\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers_initials <- customers  |>\n  mutate(initials = gsub(\"[a-z]\", \"\", name), .after = name) |>\n  mutate(initials = str_remove_all(initials, \" \")) |>\n  filter(initials == \"JD\")\n\ncustomers_initials\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"customerid\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"initials\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"address\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"citystatezip\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"birthdate\"],\"name\":[6],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"phone\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1444\",\"2\":\"Jennifer Davis\",\"3\":\"JD\",\"4\":\"4663 Park Ave S\",\"5\":\"Brooklyn, NY 11232\",\"6\":\"1940-07-29\",\"7\":\"315-356-9127\"},{\"1\":\"1514\",\"2\":\"Joshua Downs\",\"3\":\"JD\",\"4\":\"144 Park Rd N\",\"5\":\"McAllen, TX 78557\",\"6\":\"1992-05-22\",\"7\":\"682-474-3747\"},{\"1\":\"1611\",\"2\":\"Jacob Davis\",\"3\":\"JD\",\"4\":\"478B E 91st St\",\"5\":\"Manhattan, NY 10128\",\"6\":\"1961-06-02\",\"7\":\"516-521-7244\"},{\"1\":\"1742\",\"2\":\"Jonathan Davis\",\"3\":\"JD\",\"4\":\"862 Morris Park Ave\",\"5\":\"Bronx, NY 10462\",\"6\":\"1947-05-08\",\"7\":\"585-510-8718\"},{\"1\":\"1754\",\"2\":\"Jennifer Diaz\",\"3\":\"JD\",\"4\":\"135B Rogers Ave\",\"5\":\"Brooklyn, NY 11216\",\"6\":\"1982-05-20\",\"7\":\"838-499-3728\"},{\"1\":\"1950\",\"2\":\"Jennifer Davis\",\"3\":\"JD\",\"4\":\"4123B Paulding Ave\",\"5\":\"Bronx, NY 10466\",\"6\":\"1954-06-16\",\"7\":\"315-413-1113\"},{\"1\":\"2297\",\"2\":\"James Davidson\",\"3\":\"JD\",\"4\":\"55 Jackson St\",\"5\":\"Brooklyn, NY 11211\",\"6\":\"1993-10-25\",\"7\":\"516-515-6965\"},{\"1\":\"2717\",\"2\":\"Jose Duarte\",\"3\":\"JD\",\"4\":\"35-18 20th Rd\",\"5\":\"Astoria, NY 11105\",\"6\":\"1979-08-10\",\"7\":\"585-293-7342\"},{\"1\":\"2744\",\"2\":\"Johnathan Davis\",\"3\":\"JD\",\"4\":\"595 Shore Blvd\",\"5\":\"Brooklyn, NY 11235\",\"6\":\"1991-08-11\",\"7\":\"585-956-3976\"},{\"1\":\"2764\",\"2\":\"Jonathon Diaz\",\"3\":\"JD\",\"4\":\"887 Boynton Ave\",\"5\":\"Bronx, NY 10473\",\"6\":\"1995-03-04\",\"7\":\"680-839-8884\"},{\"1\":\"3046\",\"2\":\"Jessica Duncan\",\"3\":\"JD\",\"4\":\"3521 Ropes Ave\",\"5\":\"Bronx, NY 10475\",\"6\":\"1977-07-30\",\"7\":\"680-332-8760\"},{\"1\":\"3267\",\"2\":\"Jodi Duncan\",\"3\":\"JD\",\"4\":\"3475 Fort Independence St\",\"5\":\"Bronx, NY 10463\",\"6\":\"1953-04-25\",\"7\":\"315-581-7751\"},{\"1\":\"3586\",\"2\":\"James Decker\",\"3\":\"JD\",\"4\":\"320A 21st St\",\"5\":\"Brooklyn, NY 11215\",\"6\":\"1957-09-03\",\"7\":\"914-542-7892\"},{\"1\":\"3704\",\"2\":\"James Davis\",\"3\":\"JD\",\"4\":\"2380 Park Dr\",\"5\":\"Dallas, TX 75227\",\"6\":\"1974-04-08\",\"7\":\"682-969-2705\"},{\"1\":\"3874\",\"2\":\"John Decker\",\"3\":\"JD\",\"4\":\"322B Liberty Ave\",\"5\":\"Staten Island, NY 10305\",\"6\":\"1974-03-28\",\"7\":\"585-369-4611\"},{\"1\":\"3976\",\"2\":\"Janet Drake\",\"3\":\"JD\",\"4\":\"958 E 77th St\",\"5\":\"Brooklyn, NY 11236\",\"6\":\"1987-08-09\",\"7\":\"315-683-5595\"},{\"1\":\"3977\",\"2\":\"Jason Delgado\",\"3\":\"JD\",\"4\":\"246-22 76th Ave\",\"5\":\"Bellerose, NY 11426\",\"6\":\"1993-03-17\",\"7\":\"516-542-5417\"},{\"1\":\"3998\",\"2\":\"James Dixon\",\"3\":\"JD\",\"4\":\"107-40 37th Dr\",\"5\":\"Corona, NY 11368\",\"6\":\"1989-12-08\",\"7\":\"212-277-2382\"},{\"1\":\"4021\",\"2\":\"Joseph Daugherty\",\"3\":\"JD\",\"4\":\"1173 11th Ave S\",\"5\":\"Sierra Vista, AZ 85613\",\"6\":\"1963-08-27\",\"7\":\"928-693-9328\"},{\"1\":\"4095\",\"2\":\"Jane Davis\",\"3\":\"JD\",\"4\":\"2369A Ocean Pkwy\",\"5\":\"Brooklyn, NY 11223\",\"6\":\"1990-06-24\",\"7\":\"212-836-8691\"},{\"1\":\"4164\",\"2\":\"Jeremy Davis\",\"3\":\"JD\",\"4\":\"134-10 Foch Blvd\",\"5\":\"South Ozone Park, NY 11420\",\"6\":\"1995-07-26\",\"7\":\"212-771-8924\"},{\"1\":\"4936\",\"2\":\"Jennifer Diaz\",\"3\":\"JD\",\"4\":\"11 W 81st St\",\"5\":\"Manhattan, NY 10024\",\"6\":\"1963-02-05\",\"7\":\"516-293-8346\"},{\"1\":\"5011\",\"2\":\"James Deleon\",\"3\":\"JD\",\"4\":\"1832 NE 10th Ave\",\"5\":\"Phoenix, AZ 85032\",\"6\":\"1991-09-17\",\"7\":\"602-749-9778\"},{\"1\":\"5232\",\"2\":\"John Doyle\",\"3\":\"JD\",\"4\":\"274D South Ave\",\"5\":\"Staten Island, NY 10303\",\"6\":\"1974-03-20\",\"7\":\"585-926-8622\"},{\"1\":\"5270\",\"2\":\"Justin Dickerson\",\"3\":\"JD\",\"4\":\"153-9 Grand Central Pkwy\",\"5\":\"Jamaica, NY 11432\",\"6\":\"1950-06-06\",\"7\":\"347-989-5426\"},{\"1\":\"5353\",\"2\":\"James Daniels\",\"3\":\"JD\",\"4\":\"18A Thomas S Boyland St\",\"5\":\"Brooklyn, NY 11233\",\"6\":\"1951-02-27\",\"7\":\"585-230-7663\"},{\"1\":\"5469\",\"2\":\"Joe Day\",\"3\":\"JD\",\"4\":\"33-8 30th Ave\",\"5\":\"Astoria, NY 11103\",\"6\":\"1957-11-07\",\"7\":\"914-229-1901\"},{\"1\":\"5697\",\"2\":\"Julia Dixon\",\"3\":\"JD\",\"4\":\"144A Meserole Ave\",\"5\":\"Brooklyn, NY 11222\",\"6\":\"1998-02-10\",\"7\":\"315-794-6352\"},{\"1\":\"5916\",\"2\":\"Joseph Davis\",\"3\":\"JD\",\"4\":\"2385 Rear Cambreleng Ave\",\"5\":\"Bronx, NY 10458\",\"6\":\"1954-10-02\",\"7\":\"585-645-6262\"},{\"1\":\"6316\",\"2\":\"John Davis\",\"3\":\"JD\",\"4\":\"28-48 143rd St\",\"5\":\"Flushing, NY 11354\",\"6\":\"1958-09-04\",\"7\":\"315-797-2556\"},{\"1\":\"6437\",\"2\":\"Jay Doyle\",\"3\":\"JD\",\"4\":\"167-13 Grand Central Pkwy\",\"5\":\"Jamaica, NY 11432\",\"6\":\"1986-02-27\",\"7\":\"838-270-1964\"},{\"1\":\"6478\",\"2\":\"James Davis\",\"3\":\"JD\",\"4\":\"817-1 Grand St\",\"5\":\"Brooklyn, NY 11211\",\"6\":\"1976-09-18\",\"7\":\"838-355-0614\"},{\"1\":\"7056\",\"2\":\"Joy Diaz\",\"3\":\"JD\",\"4\":\"183-69 Brinkerhoff Ave\",\"5\":\"Saint Albans, NY 11412\",\"6\":\"1971-02-07\",\"7\":\"332-437-1774\"},{\"1\":\"7142\",\"2\":\"John Dawson\",\"3\":\"JD\",\"4\":\"197A E Broadway\",\"5\":\"Manhattan, NY 10002\",\"6\":\"1961-02-05\",\"7\":\"838-823-5603\"},{\"1\":\"7160\",\"2\":\"Joseph Dominguez\",\"3\":\"JD\",\"4\":\"503B Davis Ave\",\"5\":\"Staten Island, NY 10310\",\"6\":\"1943-01-11\",\"7\":\"914-642-1183\"},{\"1\":\"7299\",\"2\":\"Jennifer Drake\",\"3\":\"JD\",\"4\":\"115-33 227th St\",\"5\":\"Cambria Heights, NY 11411\",\"6\":\"1988-10-20\",\"7\":\"332-711-8937\"},{\"1\":\"7483\",\"2\":\"Joseph Davis\",\"3\":\"JD\",\"4\":\"213-4 28th Ave\",\"5\":\"Bayside, NY 11360\",\"6\":\"1969-09-29\",\"7\":\"845-952-0360\"},{\"1\":\"7515\",\"2\":\"John Dawson\",\"3\":\"JD\",\"4\":\"11 Atlantic Ave\",\"5\":\"Brooklyn, NY 11201\",\"6\":\"1955-03-02\",\"7\":\"315-313-3204\"},{\"1\":\"7594\",\"2\":\"Jennifer Daniels\",\"3\":\"JD\",\"4\":\"1803B 3rd Ave\",\"5\":\"Manhattan, NY 10029\",\"6\":\"1995-03-15\",\"7\":\"516-994-3023\"},{\"1\":\"8063\",\"2\":\"Julian Dunlap\",\"3\":\"JD\",\"4\":\"1659B Bedford Ave\",\"5\":\"Brooklyn, NY 11225\",\"6\":\"1972-02-04\",\"7\":\"315-407-6248\"},{\"1\":\"8218\",\"2\":\"Joseph Duncan\",\"3\":\"JD\",\"4\":\"3744 S Kansas Dr\",\"5\":\"Wichita, KS 67216\",\"6\":\"1959-04-07\",\"7\":\"785-870-4930\"},{\"1\":\"8721\",\"2\":\"Jennifer Diaz\",\"3\":\"JD\",\"4\":\"216-28 131st Ave\",\"5\":\"Springfield Gardens, NY 11413\",\"6\":\"1995-04-14\",\"7\":\"716-731-9967\"},{\"1\":\"8730\",\"2\":\"Joshua Dickerson\",\"3\":\"JD\",\"4\":\"3119 Park Rd\",\"5\":\"Brunswick, OH 44212\",\"6\":\"1995-06-14\",\"7\":\"937-508-3258\"},{\"1\":\"8767\",\"2\":\"Jimmy Dominguez\",\"3\":\"JD\",\"4\":\"154A Spring St\",\"5\":\"Manhattan, NY 10012\",\"6\":\"1983-04-19\",\"7\":\"332-582-3065\"},{\"1\":\"8790\",\"2\":\"James Dunn\",\"3\":\"JD\",\"4\":\"767 Elton Ave\",\"5\":\"Bronx, NY 10451\",\"6\":\"1989-05-05\",\"7\":\"516-456-4995\"},{\"1\":\"8930\",\"2\":\"Jodi Duncan\",\"3\":\"JD\",\"4\":\"601 Park St\",\"5\":\"La Grande, OR 97850\",\"6\":\"1971-12-02\",\"7\":\"971-923-4704\"},{\"1\":\"8979\",\"2\":\"Javier Diaz\",\"3\":\"JD\",\"4\":\"1251 Clay Ave\",\"5\":\"Bronx, NY 10456\",\"6\":\"1986-11-08\",\"7\":\"838-264-0667\"},{\"1\":\"9601\",\"2\":\"Justin Dixon\",\"3\":\"JD\",\"4\":\"222A 84th St\",\"5\":\"Brooklyn, NY 11209\",\"6\":\"1949-08-29\",\"7\":\"914-206-7290\"},{\"1\":\"9639\",\"2\":\"Jennifer Duarte\",\"3\":\"JD\",\"4\":\"39 Rear Claver Pl\",\"5\":\"Brooklyn, NY 11238\",\"6\":\"1954-10-13\",\"7\":\"680-732-2830\"},{\"1\":\"9950\",\"2\":\"Joseph Diaz\",\"3\":\"JD\",\"4\":\"89-36 69th Rd\",\"5\":\"Forest Hills, NY 11375\",\"6\":\"1959-05-13\",\"7\":\"516-539-8581\"},{\"1\":\"10368\",\"2\":\"Jeff Diaz\",\"3\":\"JD\",\"4\":\"97B Nassau Ave\",\"5\":\"Brooklyn, NY 11222\",\"6\":\"1974-11-01\",\"7\":\"518-223-6561\"},{\"1\":\"10438\",\"2\":\"Justin Davis\",\"3\":\"JD\",\"4\":\"4317 SW Park Pl\",\"5\":\"Saxon, SC 29378\",\"6\":\"2000-12-18\",\"7\":\"803-887-9419\"},{\"1\":\"10698\",\"2\":\"Jeffrey Dunn\",\"3\":\"JD\",\"4\":\"3686 NE Park Pl\",\"5\":\"Mauldin, SC 29607\",\"6\":\"1985-02-16\",\"7\":\"803-945-5420\"},{\"1\":\"10939\",\"2\":\"Janice Dudley\",\"3\":\"JD\",\"4\":\"1822B Pitkin Ave\",\"5\":\"Brooklyn, NY 11212\",\"6\":\"1949-12-07\",\"7\":\"516-718-8095\"},{\"1\":\"11270\",\"2\":\"Jeffrey Dyer\",\"3\":\"JD\",\"4\":\"124-3 109th Ave\",\"5\":\"South Richmond Hill, NY 11419\",\"6\":\"1964-12-18\",\"7\":\"914-631-8362\"},{\"1\":\"11466\",\"2\":\"Janet Davis\",\"3\":\"JD\",\"4\":\"693A E New York Ave\",\"5\":\"Brooklyn, NY 11203\",\"6\":\"1998-05-20\",\"7\":\"838-661-9019\"},{\"1\":\"11522\",\"2\":\"Jeffery Davis\",\"3\":\"JD\",\"4\":\"139A E 29th St\",\"5\":\"Brooklyn, NY 11226\",\"6\":\"1964-12-19\",\"7\":\"914-463-3531\"},{\"1\":\"11791\",\"2\":\"Jonathan Davies\",\"3\":\"JD\",\"4\":\"7123 Inter-A 6th Ave\",\"5\":\"Brooklyn, NY 11209\",\"6\":\"1961-10-05\",\"7\":\"838-788-1575\"},{\"1\":\"12053\",\"2\":\"Joshua Dickerson\",\"3\":\"JD\",\"4\":\"901B E Tremont Ave\",\"5\":\"Bronx, NY 10460\",\"6\":\"1966-04-27\",\"7\":\"315-629-8623\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNow we can search for the customer who made *Rug Cleaner* orders in 2017.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers_initials |>\n  left_join(orders) |>\n  filter(lubridate::year(ordered) == 2017) |>\n  left_join(orders_items) |>\n  left_join(products) |>\n  filter(str_detect(desc, regex(\"Rug Cleaner\", ignore_case = TRUE))) |>\n  add_count(customerid) |>\n  filter(n > 1) |>\n  distinct(name, phone)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Jeremy Davis\",\"2\":\"212-771-8924\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Puzzle 3: spider\n\nWe search for someone Aries born in the year of the Dog. After Googling around, I managed to get the corresponding years. Hence, the first step was to find out customers born in those years. The catch here is that we can not only look at the years for finding the possible candidates because Aries time is only between March 21st and April 19th. We also know that this person was also living in the same neighbourhood as Jeremy (the previous owner of the rug). It was just a matter of filtering out customers living in the same area.\n\n\n::: {.cell}\n\n```{.r .cell-code}\njeremy <- customers |>\n  filter(name == \"Jeremy Davis\")\n\ncustomers |>\n  filter(\n    lubridate::year(birthdate) %in% \n    c(1922, 1934, 1946, 1958, 1970, 1982, 1994, 2006, 2018, 2030),\n    between(format(birthdate, \"%m%d\"), \"0321\", \"0419\")\n  ) |>\n  filter(citystatezip == jeremy$citystatezip) |>\n  distinct(name, phone)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Brent Nguyen\",\"2\":\"516-636-7397\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Puzzle 4: owl\n\nFor this puzzle, we have to find the woman who buys from bakeries daily before 5 am.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproducts |>\n  filter(str_starts(sku, \"BKY\")) |>\n  left_join(orders_items) |>\n  left_join(orders) |>\n  filter(lubridate::hour(ordered) < 5) |>\n  left_join(customers) |>\n  count(customerid, name, phone, sort = TRUE) |>\n  slice(1)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"customerid\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5375\",\"2\":\"Christina Booker\",\"3\":\"718-649-9036\",\"4\":\"10\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Puzzle 5: koala\n\nWe are told that the next owner lives in the Queen's village and also *regularly* buys food for his/her older cats.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomers |>\n  filter(str_detect(citystatezip, regex(\"queens village\", ignore_case = TRUE))) |>\n  left_join(orders) |>\n  left_join(orders_items) |>\n  left_join(products) |>\n  filter(str_detect(desc, regex(\"senior cat\", ignore_case = TRUE))) |>\n  group_by(name, phone) |>\n  summarise(n = n_distinct(orderid), .groups = \"drop\") |>\n  slice_max(n, n = 1)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Anita Koch\",\"2\":\"315-492-7411\",\"3\":\"17\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Puzzle 6: squirrel\n\nHere, we have to find the person who only bought items that were on discount. First, calculate the total paid price and the total wholesale cost.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npurchases <- orders_items |>\n  left_join(orders) |>\n  left_join(products) |>\n  group_by(orderid) |>\n  summarise(\n    across(c(unit_price, wholesale_cost), \n    .fns = list(\"tot\" = \\(x) sum(qty * x)))\n  ) |>\n  left_join(orders) |>\n  left_join(customers)\n```\n:::\n\n\nNow we can find customers who only buy when everything is on sale (i.e, when the total paid is lower than the total wholesale cost).\n\n\n::: {.cell}\n\n```{.r .cell-code}\npurchases |>\n  group_by(customerid) |>\n  filter(all(unit_price_tot < wholesale_cost_tot)) |>\n  add_count(customerid) |>\n  filter(n > 1) |>\n  distinct(customerid, name, phone)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"customerid\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"8342\",\"2\":\"Emily Randolph\",\"3\":\"914-868-0316\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## Puzzle 7: toucan\n\nThis puzzle was for me the most challenging. I had to think for a while before starting to implement the solution. The key ideas to solve this problem are:\n\n1. Extract the colour from the item description.\n2. Find the person who bought the same item as Emily a moment after her, but with a different colour.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolored_products <- products |>\n  extract(desc,\n    into = c(\"desc\", \"color\"), \"([^()\\\\n]+)(?:(?:\\\\()(\\\\w*)(?:\\\\)))?\"\n  ) |>\n  mutate(desc = str_squish(desc)) |>\n  mutate(color = na_if(color, \"\")) |>\n  drop_na(color)\n  \ncolored_products\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"sku\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"desc\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"color\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"wholesale_cost\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"HOM0018\",\"2\":\"Power Radio\",\"3\":\"red\",\"4\":\"21.81\"},{\"1\":\"HOM0086\",\"2\":\"Power Crockpot\",\"3\":\"purple\",\"4\":\"73.90\"},{\"1\":\"COL0263\",\"2\":\"Noah's Jersey\",\"3\":\"orange\",\"4\":\"21.08\"},{\"1\":\"COL0295\",\"2\":\"Noah's Jersey\",\"3\":\"red\",\"4\":\"15.42\"},{\"1\":\"HOM0307\",\"2\":\"Handmade Crockpot\",\"3\":\"amber\",\"4\":\"138.33\"},{\"1\":\"HOM0431\",\"2\":\"Super Widget\",\"3\":\"white\",\"4\":\"4.97\"},{\"1\":\"COL0464\",\"2\":\"Noah's Action Figure\",\"3\":\"magenta\",\"4\":\"23.93\"},{\"1\":\"HOM0550\",\"2\":\"Automatic Mixer\",\"3\":\"green\",\"4\":\"89.62\"},{\"1\":\"COL0638\",\"2\":\"Noah's Jewelry\",\"3\":\"purple\",\"4\":\"43.98\"},{\"1\":\"COL0732\",\"2\":\"Noah's Gift Box\",\"3\":\"mauve\",\"4\":\"5.01\"},{\"1\":\"COL0757\",\"2\":\"Noah's Bobblehead\",\"3\":\"puce\",\"4\":\"9.04\"},{\"1\":\"COL0820\",\"2\":\"Noah's Lunchbox\",\"3\":\"blue\",\"4\":\"20.96\"},{\"1\":\"HOM0835\",\"2\":\"Power Bicycle\",\"3\":\"red\",\"4\":\"87.87\"},{\"1\":\"HOM0892\",\"2\":\"Automatic Widget\",\"3\":\"red\",\"4\":\"5.83\"},{\"1\":\"COL0971\",\"2\":\"Noah's Jersey\",\"3\":\"yellow\",\"4\":\"19.69\"},{\"1\":\"COL1035\",\"2\":\"Noah's Bobblehead\",\"3\":\"mauve\",\"4\":\"9.66\"},{\"1\":\"HOM1078\",\"2\":\"Mega Toaster\",\"3\":\"magenta\",\"4\":\"21.41\"},{\"1\":\"HOM1101\",\"2\":\"Mechanical Mixer\",\"3\":\"orange\",\"4\":\"88.93\"},{\"1\":\"COL1137\",\"2\":\"Noah's Poster\",\"3\":\"green\",\"4\":\"6.87\"},{\"1\":\"HOM1154\",\"2\":\"Automatic Machine\",\"3\":\"orange\",\"4\":\"31.44\"},{\"1\":\"COL1184\",\"2\":\"Noah's Jewelry\",\"3\":\"amber\",\"4\":\"54.23\"},{\"1\":\"HOM1216\",\"2\":\"Manual Mixer\",\"3\":\"orange\",\"4\":\"94.72\"},{\"1\":\"COL1222\",\"2\":\"Noah's Gift Box\",\"3\":\"yellow\",\"4\":\"4.54\"},{\"1\":\"HOM1296\",\"2\":\"Electric Toaster\",\"3\":\"red\",\"4\":\"19.42\"},{\"1\":\"COL1357\",\"2\":\"Noah's Lunchbox\",\"3\":\"amber\",\"4\":\"19.02\"},{\"1\":\"COL1444\",\"2\":\"Noah's Jersey\",\"3\":\"azure\",\"4\":\"22.00\"},{\"1\":\"COL1502\",\"2\":\"Noah's Lunchbox\",\"3\":\"yellow\",\"4\":\"15.32\"},{\"1\":\"COL1561\",\"2\":\"Noah's Bobblehead\",\"3\":\"yellow\",\"4\":\"9.28\"},{\"1\":\"HOM1609\",\"2\":\"Handmade Radio\",\"3\":\"yellow\",\"4\":\"43.18\"},{\"1\":\"HOM1734\",\"2\":\"Mechanical Crockpot\",\"3\":\"magenta\",\"4\":\"63.66\"},{\"1\":\"COL1840\",\"2\":\"Noah's Bobblehead\",\"3\":\"white\",\"4\":\"8.82\"},{\"1\":\"HOM1900\",\"2\":\"Handmade Crockpot\",\"3\":\"azure\",\"4\":\"143.12\"},{\"1\":\"COL1908\",\"2\":\"Noah's Poster\",\"3\":\"magenta\",\"4\":\"7.20\"},{\"1\":\"COL1909\",\"2\":\"Noah's Gift Box\",\"3\":\"white\",\"4\":\"5.48\"},{\"1\":\"COL1923\",\"2\":\"Noah's Poster\",\"3\":\"purple\",\"4\":\"8.77\"},{\"1\":\"COL1955\",\"2\":\"Noah's Lunchbox\",\"3\":\"white\",\"4\":\"15.73\"},{\"1\":\"HOM2099\",\"2\":\"Manual Crockpot\",\"3\":\"magenta\",\"4\":\"68.33\"},{\"1\":\"COL2142\",\"2\":\"Noah's Jersey\",\"3\":\"amber\",\"4\":\"16.85\"},{\"1\":\"COL2158\",\"2\":\"Noah's Lunchbox\",\"3\":\"green\",\"4\":\"17.77\"},{\"1\":\"COL2161\",\"2\":\"Noah's Gift Box\",\"3\":\"green\",\"4\":\"4.90\"},{\"1\":\"HOM2179\",\"2\":\"Mini Radio\",\"3\":\"puce\",\"4\":\"15.36\"},{\"1\":\"HOM2196\",\"2\":\"Manual Crockpot\",\"3\":\"puce\",\"4\":\"72.34\"},{\"1\":\"HOM2248\",\"2\":\"Mini Mixer\",\"3\":\"orange\",\"4\":\"96.66\"},{\"1\":\"COL2258\",\"2\":\"Noah's Jersey\",\"3\":\"purple\",\"4\":\"17.32\"},{\"1\":\"HOM2258\",\"2\":\"Toy Radio\",\"3\":\"green\",\"4\":\"14.18\"},{\"1\":\"HOM2275\",\"2\":\"Mechanical Bicycle\",\"3\":\"magenta\",\"4\":\"84.77\"},{\"1\":\"HOM2286\",\"2\":\"Electric Timer\",\"3\":\"orange\",\"4\":\"7.06\"},{\"1\":\"HOM2308\",\"2\":\"Manual Radio\",\"3\":\"red\",\"4\":\"23.25\"},{\"1\":\"HOM2388\",\"2\":\"Mini Radio\",\"3\":\"magenta\",\"4\":\"16.96\"},{\"1\":\"HOM2431\",\"2\":\"Electric Bicycle\",\"3\":\"blue\",\"4\":\"85.88\"},{\"1\":\"HOM2448\",\"2\":\"Automatic Timer\",\"3\":\"azure\",\"4\":\"7.37\"},{\"1\":\"HOM2494\",\"2\":\"Mini Timer\",\"3\":\"magenta\",\"4\":\"7.18\"},{\"1\":\"HOM2782\",\"2\":\"Manual Radio\",\"3\":\"magenta\",\"4\":\"19.49\"},{\"1\":\"HOM2803\",\"2\":\"Super Crockpot\",\"3\":\"purple\",\"4\":\"65.66\"},{\"1\":\"HOM2811\",\"2\":\"Automatic Crockpot\",\"3\":\"orange\",\"4\":\"62.59\"},{\"1\":\"HOM2857\",\"2\":\"Electric Bicycle\",\"3\":\"orange\",\"4\":\"79.33\"},{\"1\":\"HOM3009\",\"2\":\"Toy Crockpot\",\"3\":\"yellow\",\"4\":\"50.48\"},{\"1\":\"COL3026\",\"2\":\"Noah's Jersey\",\"3\":\"green\",\"4\":\"16.71\"},{\"1\":\"COL3030\",\"2\":\"Noah's Action Figure\",\"3\":\"white\",\"4\":\"26.20\"},{\"1\":\"COL3050\",\"2\":\"Noah's Jewelry\",\"3\":\"green\",\"4\":\"59.54\"},{\"1\":\"HOM3063\",\"2\":\"Manual Machine\",\"3\":\"amber\",\"4\":\"32.40\"},{\"1\":\"HOM3073\",\"2\":\"Power Crockpot\",\"3\":\"amber\",\"4\":\"70.50\"},{\"1\":\"COL3110\",\"2\":\"Noah's Action Figure\",\"3\":\"green\",\"4\":\"27.18\"},{\"1\":\"HOM3113\",\"2\":\"Mechanical Widget\",\"3\":\"azure\",\"4\":\"4.95\"},{\"1\":\"HOM3149\",\"2\":\"Super Machine\",\"3\":\"purple\",\"4\":\"30.22\"},{\"1\":\"COL3286\",\"2\":\"Noah's Jersey\",\"3\":\"magenta\",\"4\":\"19.51\"},{\"1\":\"HOM3296\",\"2\":\"Electric Blender\",\"3\":\"purple\",\"4\":\"49.64\"},{\"1\":\"COL3406\",\"2\":\"Noah's Jewelry\",\"3\":\"white\",\"4\":\"44.83\"},{\"1\":\"COL3461\",\"2\":\"Noah's Poster\",\"3\":\"orange\",\"4\":\"5.67\"},{\"1\":\"COL3572\",\"2\":\"Noah's Jewelry\",\"3\":\"magenta\",\"4\":\"57.55\"},{\"1\":\"COL3669\",\"2\":\"Noah's Poster\",\"3\":\"puce\",\"4\":\"6.97\"},{\"1\":\"HOM3733\",\"2\":\"Mechanical Timer\",\"3\":\"magenta\",\"4\":\"6.96\"},{\"1\":\"HOM3770\",\"2\":\"Automatic Machine\",\"3\":\"white\",\"4\":\"26.22\"},{\"1\":\"COL3822\",\"2\":\"Noah's Jersey\",\"3\":\"blue\",\"4\":\"18.56\"},{\"1\":\"COL3831\",\"2\":\"Noah's Jewelry\",\"3\":\"orange\",\"4\":\"49.80\"},{\"1\":\"COL3888\",\"2\":\"Noah's Poster\",\"3\":\"amber\",\"4\":\"6.41\"},{\"1\":\"HOM3940\",\"2\":\"Manual Radio\",\"3\":\"mauve\",\"4\":\"18.27\"},{\"1\":\"HOM3956\",\"2\":\"Power Timer\",\"3\":\"green\",\"4\":\"7.20\"},{\"1\":\"HOM3966\",\"2\":\"Power Bicycle\",\"3\":\"white\",\"4\":\"82.88\"},{\"1\":\"COL4001\",\"2\":\"Noah's Jewelry\",\"3\":\"yellow\",\"4\":\"53.74\"},{\"1\":\"COL4175\",\"2\":\"Noah's Jersey\",\"3\":\"puce\",\"4\":\"19.10\"},{\"1\":\"HOM4224\",\"2\":\"Electric Blender\",\"3\":\"mauve\",\"4\":\"65.41\"},{\"1\":\"HOM4226\",\"2\":\"Mega Blender\",\"3\":\"orange\",\"4\":\"54.99\"},{\"1\":\"COL4233\",\"2\":\"Noah's Poster\",\"3\":\"azure\",\"4\":\"7.31\"},{\"1\":\"HOM4375\",\"2\":\"Automatic Mixer\",\"3\":\"white\",\"4\":\"108.20\"},{\"1\":\"COL4384\",\"2\":\"Noah's Poster\",\"3\":\"white\",\"4\":\"7.52\"},{\"1\":\"HOM4438\",\"2\":\"Handmade Radio\",\"3\":\"blue\",\"4\":\"33.17\"},{\"1\":\"HOM4516\",\"2\":\"Power Bicycle\",\"3\":\"magenta\",\"4\":\"64.62\"},{\"1\":\"HOM4596\",\"2\":\"Mechanical Widget\",\"3\":\"purple\",\"4\":\"5.34\"},{\"1\":\"HOM4712\",\"2\":\"Automatic Radio\",\"3\":\"azure\",\"4\":\"19.52\"},{\"1\":\"COL4761\",\"2\":\"Noah's Action Figure\",\"3\":\"yellow\",\"4\":\"26.32\"},{\"1\":\"COL4787\",\"2\":\"Noah's Gift Box\",\"3\":\"purple\",\"4\":\"5.32\"},{\"1\":\"COL4807\",\"2\":\"Noah's Poster\",\"3\":\"yellow\",\"4\":\"7.82\"},{\"1\":\"HOM4837\",\"2\":\"Power Radio\",\"3\":\"green\",\"4\":\"19.05\"},{\"1\":\"COL4944\",\"2\":\"Noah's Jersey\",\"3\":\"white\",\"4\":\"18.79\"},{\"1\":\"HOM4995\",\"2\":\"Manual Timer\",\"3\":\"orange\",\"4\":\"7.39\"},{\"1\":\"HOM5080\",\"2\":\"Automatic Bicycle\",\"3\":\"blue\",\"4\":\"71.94\"},{\"1\":\"HOM5127\",\"2\":\"Electric Toaster\",\"3\":\"blue\",\"4\":\"21.72\"},{\"1\":\"HOM5134\",\"2\":\"Electric Toaster\",\"3\":\"mauve\",\"4\":\"24.02\"},{\"1\":\"HOM5139\",\"2\":\"Electric Machine\",\"3\":\"amber\",\"4\":\"31.81\"},{\"1\":\"HOM5190\",\"2\":\"Power Toaster\",\"3\":\"white\",\"4\":\"18.93\"},{\"1\":\"HOM5271\",\"2\":\"Mechanical Machine\",\"3\":\"mauve\",\"4\":\"27.16\"},{\"1\":\"COL5299\",\"2\":\"Noah's Bobblehead\",\"3\":\"magenta\",\"4\":\"9.54\"},{\"1\":\"HOM5312\",\"2\":\"Electric Radio\",\"3\":\"blue\",\"4\":\"19.18\"},{\"1\":\"COL5317\",\"2\":\"Noah's Gift Box\",\"3\":\"blue\",\"4\":\"5.40\"},{\"1\":\"COL5421\",\"2\":\"Noah's Action Figure\",\"3\":\"mauve\",\"4\":\"25.46\"},{\"1\":\"HOM5666\",\"2\":\"Manual Toaster\",\"3\":\"orange\",\"4\":\"19.68\"},{\"1\":\"HOM5682\",\"2\":\"Toy Mixer\",\"3\":\"amber\",\"4\":\"72.48\"},{\"1\":\"HOM5838\",\"2\":\"Electric Crockpot\",\"3\":\"purple\",\"4\":\"71.36\"},{\"1\":\"COL5864\",\"2\":\"Noah's Gift Box\",\"3\":\"azure\",\"4\":\"6.47\"},{\"1\":\"COL5914\",\"2\":\"Noah's Lunchbox\",\"3\":\"red\",\"4\":\"19.36\"},{\"1\":\"HOM5937\",\"2\":\"Mechanical Bicycle\",\"3\":\"orange\",\"4\":\"64.40\"},{\"1\":\"COL5979\",\"2\":\"Noah's Gift Box\",\"3\":\"amber\",\"4\":\"5.87\"},{\"1\":\"HOM6084\",\"2\":\"Automatic Crockpot\",\"3\":\"blue\",\"4\":\"79.87\"},{\"1\":\"HOM6145\",\"2\":\"Handmade Mixer\",\"3\":\"red\",\"4\":\"218.11\"},{\"1\":\"HOM6326\",\"2\":\"Vintage Toaster\",\"3\":\"green\",\"4\":\"25.02\"},{\"1\":\"HOM6344\",\"2\":\"Automatic Blender\",\"3\":\"orange\",\"4\":\"50.41\"},{\"1\":\"HOM6435\",\"2\":\"Vintage Blender\",\"3\":\"yellow\",\"4\":\"70.49\"},{\"1\":\"COL6455\",\"2\":\"Noah's Bobblehead\",\"3\":\"amber\",\"4\":\"9.88\"},{\"1\":\"HOM6475\",\"2\":\"Super Bicycle\",\"3\":\"amber\",\"4\":\"75.96\"},{\"1\":\"HOM6547\",\"2\":\"Electric Crockpot\",\"3\":\"amber\",\"4\":\"78.67\"},{\"1\":\"COL6549\",\"2\":\"Noah's Lunchbox\",\"3\":\"magenta\",\"4\":\"17.36\"},{\"1\":\"HOM6626\",\"2\":\"Manual Bicycle\",\"3\":\"blue\",\"4\":\"66.97\"},{\"1\":\"COL6628\",\"2\":\"Noah's Gift Box\",\"3\":\"red\",\"4\":\"4.81\"},{\"1\":\"COL6708\",\"2\":\"Noah's Action Figure\",\"3\":\"red\",\"4\":\"27.51\"},{\"1\":\"HOM6727\",\"2\":\"Vintage Blender\",\"3\":\"blue\",\"4\":\"61.66\"},{\"1\":\"COL6782\",\"2\":\"Noah's Lunchbox\",\"3\":\"orange\",\"4\":\"17.74\"},{\"1\":\"HOM6805\",\"2\":\"Electric Timer\",\"3\":\"puce\",\"4\":\"7.93\"},{\"1\":\"COL6819\",\"2\":\"Noah's Jersey\",\"3\":\"mauve\",\"4\":\"16.90\"},{\"1\":\"COL6865\",\"2\":\"Noah's Jewelry\",\"3\":\"mauve\",\"4\":\"46.52\"},{\"1\":\"HOM6871\",\"2\":\"Manual Timer\",\"3\":\"green\",\"4\":\"7.11\"},{\"1\":\"HOM6954\",\"2\":\"Mechanical Blender\",\"3\":\"puce\",\"4\":\"44.32\"},{\"1\":\"HOM6989\",\"2\":\"Manual Widget\",\"3\":\"magenta\",\"4\":\"4.23\"},{\"1\":\"COL7026\",\"2\":\"Noah's Action Figure\",\"3\":\"orange\",\"4\":\"25.49\"},{\"1\":\"HOM7105\",\"2\":\"Handmade Toaster\",\"3\":\"blue\",\"4\":\"33.65\"},{\"1\":\"HOM7152\",\"2\":\"Automatic Widget\",\"3\":\"magenta\",\"4\":\"5.17\"},{\"1\":\"HOM7304\",\"2\":\"Vintage Crockpot\",\"3\":\"amber\",\"4\":\"124.62\"},{\"1\":\"COL7385\",\"2\":\"Noah's Lunchbox\",\"3\":\"mauve\",\"4\":\"19.01\"},{\"1\":\"HOM7425\",\"2\":\"Electric Bicycle\",\"3\":\"mauve\",\"4\":\"78.79\"},{\"1\":\"HOM7757\",\"2\":\"Electric Machine\",\"3\":\"purple\",\"4\":\"29.43\"},{\"1\":\"COL7794\",\"2\":\"Noah's Poster\",\"3\":\"red\",\"4\":\"7.12\"},{\"1\":\"HOM7845\",\"2\":\"Mini Mixer\",\"3\":\"puce\",\"4\":\"100.17\"},{\"1\":\"COL7913\",\"2\":\"Noah's Action Figure\",\"3\":\"amber\",\"4\":\"31.98\"},{\"1\":\"COL7968\",\"2\":\"Noah's Gift Box\",\"3\":\"puce\",\"4\":\"5.30\"},{\"1\":\"COL8041\",\"2\":\"Noah's Lunchbox\",\"3\":\"puce\",\"4\":\"14.78\"},{\"1\":\"HOM8143\",\"2\":\"Power Bicycle\",\"3\":\"amber\",\"4\":\"76.87\"},{\"1\":\"HOM8167\",\"2\":\"Mega Timer\",\"3\":\"mauve\",\"4\":\"7.16\"},{\"1\":\"HOM8176\",\"2\":\"Vintage Crockpot\",\"3\":\"azure\",\"4\":\"97.42\"},{\"1\":\"COL8297\",\"2\":\"Noah's Action Figure\",\"3\":\"azure\",\"4\":\"32.53\"},{\"1\":\"COL8308\",\"2\":\"Noah's Bobblehead\",\"3\":\"green\",\"4\":\"9.72\"},{\"1\":\"HOM8343\",\"2\":\"Electric Toaster\",\"3\":\"white\",\"4\":\"24.16\"},{\"1\":\"COL8384\",\"2\":\"Noah's Lunchbox\",\"3\":\"purple\",\"4\":\"18.46\"},{\"1\":\"COL8406\",\"2\":\"Noah's Action Figure\",\"3\":\"puce\",\"4\":\"27.98\"},{\"1\":\"COL8453\",\"2\":\"Noah's Jewelry\",\"3\":\"blue\",\"4\":\"51.90\"},{\"1\":\"COL8456\",\"2\":\"Noah's Bobblehead\",\"3\":\"red\",\"4\":\"8.48\"},{\"1\":\"HOM8473\",\"2\":\"Automatic Bicycle\",\"3\":\"red\",\"4\":\"79.34\"},{\"1\":\"HOM8486\",\"2\":\"Mini Machine\",\"3\":\"blue\",\"4\":\"29.27\"},{\"1\":\"COL8506\",\"2\":\"Noah's Bobblehead\",\"3\":\"purple\",\"4\":\"9.04\"},{\"1\":\"HOM8569\",\"2\":\"Power Bicycle\",\"3\":\"green\",\"4\":\"87.43\"},{\"1\":\"COL8758\",\"2\":\"Noah's Poster\",\"3\":\"mauve\",\"4\":\"6.79\"},{\"1\":\"HOM8793\",\"2\":\"Automatic Machine\",\"3\":\"red\",\"4\":\"38.55\"},{\"1\":\"HOM8833\",\"2\":\"Manual Toaster\",\"3\":\"yellow\",\"4\":\"18.95\"},{\"1\":\"HOM8864\",\"2\":\"Mechanical Crockpot\",\"3\":\"purple\",\"4\":\"63.93\"},{\"1\":\"HOM8870\",\"2\":\"Mega Mixer\",\"3\":\"orange\",\"4\":\"92.25\"},{\"1\":\"HOM8910\",\"2\":\"Power Machine\",\"3\":\"amber\",\"4\":\"27.16\"},{\"1\":\"COL8942\",\"2\":\"Noah's Gift Box\",\"3\":\"magenta\",\"4\":\"5.37\"},{\"1\":\"HOM9008\",\"2\":\"Manual Blender\",\"3\":\"magenta\",\"4\":\"48.26\"},{\"1\":\"HOM9025\",\"2\":\"Mechanical Bicycle\",\"3\":\"amber\",\"4\":\"66.07\"},{\"1\":\"HOM9038\",\"2\":\"Power Radio\",\"3\":\"magenta\",\"4\":\"20.32\"},{\"1\":\"COL9044\",\"2\":\"Noah's Action Figure\",\"3\":\"blue\",\"4\":\"28.19\"},{\"1\":\"HOM9091\",\"2\":\"Vintage Widget\",\"3\":\"white\",\"4\":\"7.42\"},{\"1\":\"HOM9216\",\"2\":\"Automatic Timer\",\"3\":\"magenta\",\"4\":\"6.27\"},{\"1\":\"HOM9234\",\"2\":\"Automatic Mixer\",\"3\":\"blue\",\"4\":\"104.63\"},{\"1\":\"COL9312\",\"2\":\"Noah's Lunchbox\",\"3\":\"azure\",\"4\":\"20.37\"},{\"1\":\"HOM9393\",\"2\":\"Automatic Blender\",\"3\":\"purple\",\"4\":\"51.18\"},{\"1\":\"HOM9423\",\"2\":\"Electric Widget\",\"3\":\"purple\",\"4\":\"5.83\"},{\"1\":\"COL9448\",\"2\":\"Noah's Poster\",\"3\":\"blue\",\"4\":\"7.60\"},{\"1\":\"COL9469\",\"2\":\"Noah's Jewelry\",\"3\":\"puce\",\"4\":\"64.02\"},{\"1\":\"HOM9679\",\"2\":\"Power Timer\",\"3\":\"orange\",\"4\":\"5.77\"},{\"1\":\"COL9688\",\"2\":\"Noah's Bobblehead\",\"3\":\"azure\",\"4\":\"11.42\"},{\"1\":\"COL9689\",\"2\":\"Noah's Jewelry\",\"3\":\"azure\",\"4\":\"62.01\"},{\"1\":\"HOM9734\",\"2\":\"Super Machine\",\"3\":\"puce\",\"4\":\"29.88\"},{\"1\":\"HOM9772\",\"2\":\"Automatic Blender\",\"3\":\"mauve\",\"4\":\"46.52\"},{\"1\":\"COL9842\",\"2\":\"Noah's Gift Box\",\"3\":\"orange\",\"4\":\"5.66\"},{\"1\":\"HOM9868\",\"2\":\"Mini Radio\",\"3\":\"white\",\"4\":\"18.24\"},{\"1\":\"HOM9988\",\"2\":\"Mini Crockpot\",\"3\":\"purple\",\"4\":\"59.93\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nBased on this list, we have to find the date on which Emily made purchases and for which the same item was bought in at least two colours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolored_products |>\n  left_join(orders_items) |>\n  left_join(orders) |>\n  left_join(customers) |>\n  group_by(date = as.Date(ordered), desc) |>\n  filter(length(unique(color)) > 1 & any(customerid == 8342)) |>\n  ungroup() |>\n  distinct(desc, color, name, color, phone, ordered) |>\n  arrange(ordered) \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"desc\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"color\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ordered\"],\"name\":[3],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Electric Machine\",\"2\":\"amber\",\"3\":\"2019-06-01 12:50:16\",\"4\":\"Emily Randolph\",\"5\":\"914-868-0316\"},{\"1\":\"Electric Machine\",\"2\":\"purple\",\"3\":\"2019-06-01 12:50:25\",\"4\":\"Jonathan Adams\",\"5\":\"315-618-5263\"},{\"1\":\"Electric Toaster\",\"2\":\"mauve\",\"3\":\"2019-08-18 12:47:14\",\"4\":\"Melvin Rodriguez III\",\"5\":\"914-698-1257\"},{\"1\":\"Electric Toaster\",\"2\":\"blue\",\"3\":\"2019-08-18 14:20:28\",\"4\":\"Emily Randolph\",\"5\":\"914-868-0316\"},{\"1\":\"Electric Toaster\",\"2\":\"blue\",\"3\":\"2019-08-18 21:22:58\",\"4\":\"Dana Wright\",\"5\":\"838-284-6715\"},{\"1\":\"Noah's Jewelry\",\"2\":\"green\",\"3\":\"2021-04-17 11:14:30\",\"4\":\"Timothy Jones\",\"5\":\"716-691-6727\"},{\"1\":\"Noah's Jewelry\",\"2\":\"yellow\",\"3\":\"2021-04-17 12:22:55\",\"4\":\"Frank Roach\",\"5\":\"516-520-9716\"},{\"1\":\"Noah's Jewelry\",\"2\":\"blue\",\"3\":\"2021-04-17 15:54:57\",\"4\":\"James Anderson\",\"5\":\"516-689-9580\"},{\"1\":\"Noah's Jewelry\",\"2\":\"yellow\",\"3\":\"2021-04-17 19:52:28\",\"4\":\"Emily Randolph\",\"5\":\"914-868-0316\"},{\"1\":\"Noah's Jewelry\",\"2\":\"orange\",\"3\":\"2022-07-26 08:18:05\",\"4\":\"Emily Randolph\",\"5\":\"914-868-0316\"},{\"1\":\"Noah's Jewelry\",\"2\":\"azure\",\"3\":\"2022-07-26 12:05:26\",\"4\":\"Beth Mack\",\"5\":\"315-444-9913\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nLooking at the time of purchase, we can find that Jonathan Adams also bought an Electric Machine with a different colour just a few seconds after Emily.\n\n## Puzzle 8: snake\n\nFor this puzzle, we have to find the customer who is collecting the most different items sold by Noah's.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproducts |>\n  filter(str_detect(desc, \"Noah's\")) |>\n  left_join(orders_items) |>\n  left_join(orders) |>\n  group_by(customerid) |>\n  summarise(n = n_distinct(desc)) |>\n  slice_max(n, n = 1) |>\n  left_join(customers) |>\n  select(name, phone)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"phone\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Travis Bartlett\",\"2\":\"929-906-5980\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Conclusions\n\nThese quick data challenges were quite fun to solve. It [looks like](https://www.visidata.org/blog/2022/hanukkah-of-data-wrap-up/) that more puzzles will be added in the future, so keep an eye open if you are interested.\n\n<details>\n  \n<summary>Session info</summary>\n\n\n::: {.cell}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.2.2 (2022-10-31)\n#>  os       Ubuntu 22.10\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Toronto\n#>  date     2022-12-29\n#>  pandoc   2.17.1.1 @ /usr/bin/ (via rmarkdown)\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  ! package       * version date (UTC) lib source\n#>  P assertthat      0.2.1   2019-03-21 [?] CRAN (R 4.2.2)\n#>  P backports       1.4.1   2021-12-13 [?] CRAN (R 4.2.2)\n#>  P bit             4.0.4   2020-08-04 [?] RSPM (R 4.2.2)\n#>  P bit64           4.0.5   2020-08-30 [?] CRAN (R 4.2.2)\n#>  P broom           1.0.0   2022-07-01 [?] CRAN (R 4.2.1)\n#>  P cachem          1.0.6   2021-08-19 [?] CRAN (R 4.2.2)\n#>  P callr           3.7.1   2022-07-13 [?] RSPM (R 4.2.0)\n#>  P cellranger      1.1.0   2016-07-27 [?] CRAN (R 4.2.2)\n#>  P cli             3.3.0   2022-04-25 [?] CRAN (R 4.2.1)\n#>  P colorspace      2.0-3   2022-02-21 [?] CRAN (R 4.2.2)\n#>  P crayon          1.5.1   2022-03-26 [?] CRAN (R 4.2.1)\n#>  P curl            4.3.2   2021-06-23 [?] RSPM (R 4.2.2)\n#>  P DBI             1.1.3   2022-06-18 [?] RSPM (R 4.2.0)\n#>  P dbplyr          2.2.1   2022-06-27 [?] CRAN (R 4.2.2)\n#>  P devtools        2.4.4   2022-07-20 [?] RSPM (R 4.2.0)\n#>  P DiagrammeR      1.0.9   2022-03-05 [?] RSPM (R 4.2.2)\n#>  P digest          0.6.29  2021-12-01 [?] CRAN (R 4.2.1)\n#>  P dm            * 1.0.3   2022-10-12 [?] RSPM (R 4.2.2)\n#>  P dplyr         * 1.0.9   2022-04-28 [?] CRAN (R 4.2.1)\n#>  P ellipsis        0.3.2   2021-04-29 [?] CRAN (R 4.2.2)\n#>  P evaluate        0.16    2022-08-09 [?] CRAN (R 4.2.1)\n#>  P extrafont       0.18    2022-04-12 [?] CRAN (R 4.2.2)\n#>  P extrafontdb     1.0     2012-06-11 [?] CRAN (R 4.2.2)\n#>  P fansi           1.0.3   2022-03-24 [?] CRAN (R 4.2.2)\n#>  P fastmap         1.1.0   2021-01-25 [?] CRAN (R 4.2.2)\n#>  P forcats       * 0.5.1   2021-01-27 [?] RSPM (R 4.2.0)\n#>  P fs              1.5.2   2021-12-08 [?] CRAN (R 4.2.2)\n#>  P gargle          1.2.0   2021-07-02 [?] RSPM (R 4.2.2)\n#>  P generics        0.1.3   2022-07-05 [?] CRAN (R 4.2.2)\n#>  P ggplot2       * 3.3.6   2022-05-03 [?] CRAN (R 4.2.1)\n#>  P ggpmthemes    * 0.0.2   2022-08-13 [?] Github (pmassicotte/ggpmthemes@993d61e)\n#>  P glue            1.6.2   2022-02-24 [?] CRAN (R 4.2.2)\n#>  P googledrive     2.0.0   2021-07-08 [?] CRAN (R 4.2.2)\n#>  P googlesheets4   1.0.1   2022-08-13 [?] CRAN (R 4.2.2)\n#>  P gt              0.7.0   2022-08-25 [?] RSPM (R 4.2.0)\n#>  P gtable          0.3.0   2019-03-25 [?] CRAN (R 4.2.1)\n#>  P haven           2.5.0   2022-04-15 [?] RSPM (R 4.2.0)\n#>  P hms             1.1.1   2021-09-26 [?] RSPM (R 4.2.0)\n#>  P htmltools       0.5.3   2022-07-18 [?] CRAN (R 4.2.2)\n#>  P htmlwidgets     1.5.4   2021-09-08 [?] CRAN (R 4.2.1)\n#>  P httpuv          1.6.5   2022-01-05 [?] RSPM (R 4.2.0)\n#>  P httr            1.4.4   2022-08-17 [?] CRAN (R 4.2.2)\n#>  P igraph          1.3.5   2022-09-22 [?] RSPM (R 4.2.2)\n#>  P janitor         2.1.0   2021-01-05 [?] CRAN (R 4.2.1)\n#>  P jsonlite        1.8.2   2022-10-02 [?] RSPM (R 4.2.0)\n#>  P knitr           1.39    2022-04-26 [?] RSPM (R 4.2.0)\n#>  P later           1.3.0   2021-08-18 [?] RSPM (R 4.2.2)\n#>  P lifecycle       1.0.1   2021-09-24 [?] CRAN (R 4.2.1)\n#>  P lubridate       1.8.0   2021-10-07 [?] RSPM (R 4.2.2)\n#>  P magrittr        2.0.3   2022-03-30 [?] RSPM (R 4.2.0)\n#>  P memoise         2.0.1   2021-11-26 [?] CRAN (R 4.2.2)\n#>  P mime            0.12    2021-09-28 [?] CRAN (R 4.2.2)\n#>  P miniUI          0.1.1.1 2018-05-18 [?] RSPM (R 4.2.0)\n#>  P modelr          0.1.8   2020-05-19 [?] RSPM (R 4.2.0)\n#>  P munsell         0.5.0   2018-06-12 [?] CRAN (R 4.2.2)\n#>  P pillar          1.8.0   2022-07-18 [?] RSPM (R 4.2.0)\n#>  P pkgbuild        1.3.1   2021-12-20 [?] RSPM (R 4.2.0)\n#>  P pkgconfig       2.0.3   2019-09-22 [?] CRAN (R 4.2.2)\n#>  P pkgload         1.3.0   2022-06-27 [?] RSPM (R 4.2.2)\n#>  P prettyunits     1.1.1   2020-01-24 [?] CRAN (R 4.2.2)\n#>  P processx        3.7.0   2022-07-07 [?] CRAN (R 4.2.1)\n#>  P profvis         0.3.7   2020-11-02 [?] RSPM (R 4.2.0)\n#>  P promises        1.2.0.1 2021-02-11 [?] CRAN (R 4.2.1)\n#>  P ps              1.7.1   2022-06-18 [?] CRAN (R 4.2.1)\n#>  P purrr         * 0.3.4   2020-04-17 [?] CRAN (R 4.2.1)\n#>  P R6              2.5.1   2021-08-19 [?] CRAN (R 4.2.2)\n#>  P RColorBrewer    1.1-3   2022-04-03 [?] CRAN (R 4.2.2)\n#>  P Rcpp            1.0.9   2022-07-08 [?] RSPM (R 4.2.0)\n#>  P readr         * 2.1.2   2022-01-30 [?] RSPM (R 4.2.2)\n#>  P readxl          1.4.1   2022-08-17 [?] CRAN (R 4.2.2)\n#>  P remotes         2.4.2   2021-11-30 [?] RSPM (R 4.2.2)\n#>    renv            0.15.5  2022-05-26 [1] CRAN (R 4.2.2)\n#>  P reprex          2.0.2   2022-08-17 [?] CRAN (R 4.2.2)\n#>  P rlang           1.0.4   2022-07-12 [?] CRAN (R 4.2.1)\n#>  P rmarkdown       2.15    2022-08-16 [?] RSPM (R 4.2.0)\n#>  P rstudioapi      0.13    2020-11-12 [?] RSPM (R 4.2.0)\n#>  P Rttf2pt1        1.3.8   2020-01-10 [?] RSPM (R 4.2.0)\n#>  P rvest           1.0.2   2021-10-16 [?] RSPM (R 4.2.0)\n#>  P sass            0.4.2   2022-07-16 [?] RSPM (R 4.2.2)\n#>  P scales          1.2.0   2022-04-13 [?] RSPM (R 4.2.0)\n#>  P sessioninfo     1.2.2   2021-12-06 [?] RSPM (R 4.2.0)\n#>  P shiny           1.7.2   2022-07-19 [?] RSPM (R 4.2.0)\n#>  P snakecase       0.11.0  2019-05-25 [?] CRAN (R 4.2.1)\n#>  P stringi         1.7.8   2022-07-11 [?] CRAN (R 4.2.2)\n#>  P stringr       * 1.4.0   2019-02-10 [?] RSPM (R 4.2.0)\n#>  P tibble        * 3.1.8   2022-07-22 [?] CRAN (R 4.2.2)\n#>  P tidyr         * 1.2.0   2022-02-01 [?] RSPM (R 4.2.2)\n#>  P tidyselect      1.1.2   2022-02-21 [?] CRAN (R 4.2.1)\n#>  P tidyverse     * 1.3.2   2022-07-18 [?] CRAN (R 4.2.1)\n#>  P tzdb            0.3.0   2022-03-28 [?] CRAN (R 4.2.2)\n#>  P urlchecker      1.0.1   2021-11-30 [?] RSPM (R 4.2.0)\n#>  P usethis         2.1.6   2022-05-25 [?] RSPM (R 4.2.0)\n#>  P utf8            1.2.2   2021-07-24 [?] CRAN (R 4.2.2)\n#>  P vctrs           0.4.1   2022-04-13 [?] CRAN (R 4.2.1)\n#>  P visNetwork      2.1.2   2022-09-29 [?] RSPM (R 4.2.2)\n#>  P vroom           1.5.7   2021-11-30 [?] RSPM (R 4.2.2)\n#>  P withr           2.5.0   2022-03-03 [?] CRAN (R 4.2.2)\n#>  P xfun            0.32    2022-08-10 [?] CRAN (R 4.2.1)\n#>  P xml2            1.3.3   2021-11-30 [?] CRAN (R 4.2.2)\n#>  P xtable          1.8-4   2019-04-21 [?] RSPM (R 4.2.0)\n#>  P yaml            2.3.5   2022-02-21 [?] CRAN (R 4.2.1)\n#> \n#>  [1] /media/work/r-blog/renv/library/R-4.2/x86_64-pc-linux-gnu\n#>  [2] /usr/local/lib/R/library\n#> \n#>  P ── Loaded and on-disk path mismatch.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n\n\n</details>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/viz-1.8.2/viz.js\"></script>\n<link href=\"../../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/grViz-binding-1.0.9/grViz.js\"></script>\n<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}