{
  "hash": "6817398ddad10dffddfc6b448f7d53a7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Separating/exploding spatial features with R\"\nauthor: \"Philippe Massicotte\"\ndate: \"2023-08-15\"\ncategories: [R, rspatial, Geospatial]\n# the preview file needs to be named preview.png\n# mogrify -format png preview.jpg\n# https://quarto.org/docs/websites/website-tools.html#preview-images\neditor_options:\n  chunk_output_type: console\ncitation: true\n---\n\n\n\n\n\n\n\n\nIt has been a while since I posted something! But today I wanted to quickly experiment and create a map where I could separate/explode the spatial geometries. Let's first download the polygon data for Canada.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada <- rnaturalearth::ne_states(country = \"canada\", returnclass = \"sf\") |>\n  st_make_valid()\n```\n:::\n\n\n\n\nAs we can see, there are three different regions.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada |>\n  distinct(region)\n#>            region\n#> 1  Western Canada\n#> 2  Eastern Canada\n#> 3 Northern Canada\n```\n:::\n\n\n\n\nThese regions can be visualized using `ggplot2` and `sf`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get a good CRS for Canada\ncrsuggest::suggest_crs(canada)\n#> # A tibble: 10 × 6\n#>    crs_code crs_name                        crs_type crs_gcs crs_units crs_proj4\n#>    <chr>    <chr>                           <chr>      <dbl> <chr>     <chr>    \n#>  1 5931     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  2 3979     NAD83(CSRS) / Canada Atlas Lam… project…    4617 m         +proj=lc…\n#>  3 3978     NAD83 / Canada Atlas Lambert    project…    4269 m         +proj=lc…\n#>  4 3348     NAD83(CSRS) / Statistics Canad… project…    4617 m         +proj=lc…\n#>  5 3347     NAD83 / Statistics Canada Lamb… project…    4269 m         +proj=lc…\n#>  6 5926     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  7 5921     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  8 6350     NAD83(2011) / Conus Albers      project…    6318 m         +proj=ae…\n#>  9 5072     NAD83(NSRS2007) / Conus Albers  project…    4759 m         +proj=ae…\n#> 10 5071     NAD83(HARN) / Conus Albers      project…    4152 m         +proj=ae…\n\ncanada <- canada |>\n  st_transform(5931)\n\ncanada |>\n  ggplot(aes(fill = region)) +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-original-map-1.png)\n:::\n:::\n\n\n\n\nWith this following code, we can find the centroid of each region and shift the centers of the new polygons.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada_exploded <- canada |>\n  group_by(region) |>\n  mutate(region_centroid = st_centroid(st_union(geometry))) |>\n  ungroup() |>\n  mutate(geometry = (geometry - region_centroid) * 0.9 + region_centroid)\n\nst_crs(canada_exploded)\n#> Coordinate Reference System: NA\n```\n:::\n\n\n\n\nAs seen above, for a reason I do not know, we have lost the CRS after the operation, so I have to set it back before visualizing it.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada_exploded <- canada_exploded |>\n  st_set_crs(5931)\n\ncanada_exploded |>\n  ggplot(aes(fill = region)) +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-exploded-map-1.png)\n:::\n:::\n\n\n\n\n<details>\n  \n<summary>Session info</summary>\n\n\n\n\n::: {.cell}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.5.0 (2025-04-11)\n#>  os       Linux Mint 22\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Montreal\n#>  date     2025-06-12\n#>  pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n#>  quarto   1.6.39 @ /usr/local/bin/quarto\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  ! package            * version    date (UTC) lib source\n#>  P base64enc            0.1-3      2015-07-28 [?] RSPM (R 4.5.0)\n#>  P cachem               1.1.0      2024-05-16 [?] RSPM (R 4.5.0)\n#>  P class                7.3-23     2025-01-01 [?] CRAN (R 4.4.2)\n#>  P classInt             0.4-11     2025-01-08 [?] RSPM\n#>  P cli                  3.6.5      2025-04-23 [?] CRAN (R 4.5.0)\n#>  P codetools            0.2-20     2024-03-31 [?] CRAN (R 4.4.0)\n#>  P crosstalk            1.2.1      2023-11-23 [?] RSPM\n#>  P crsuggest            0.4        2022-07-06 [?] RSPM\n#>  P DBI                  1.2.3      2024-06-02 [?] RSPM (R 4.5.0)\n#>  P devtools             2.4.5      2022-10-11 [?] RSPM (R 4.5.0)\n#>  P digest               0.6.37     2024-08-19 [?] RSPM (R 4.5.0)\n#>  P dplyr              * 1.1.4      2023-11-17 [?] RSPM (R 4.5.0)\n#>  P e1071                1.7-16     2024-09-16 [?] RSPM (R 4.5.0)\n#>  P ellipsis             0.3.2      2021-04-29 [?] RSPM (R 4.5.0)\n#>  P evaluate             1.0.3      2025-01-10 [?] RSPM\n#>  P extrafont            0.19       2023-01-18 [?] RSPM\n#>  P extrafontdb          1.0        2012-06-11 [?] RSPM\n#>  P farver               2.1.2      2024-05-13 [?] RSPM (R 4.5.0)\n#>  P fastmap              1.2.0      2024-05-15 [?] RSPM (R 4.5.0)\n#>  P forcats            * 1.0.0      2023-01-29 [?] RSPM\n#>  P fs                   1.6.6      2025-04-12 [?] RSPM\n#>  P generics             0.1.4      2025-05-09 [?] RSPM\n#>  P ggplot2            * 3.5.2      2025-04-09 [?] RSPM\n#>  P ggpmthemes         * 0.0.2      2025-04-14 [?] Github (pmassicotte/ggpmthemes@993d61e)\n#>  P glue                 1.8.0      2024-09-30 [?] RSPM (R 4.5.0)\n#>  P gtable               0.3.6      2024-10-25 [?] RSPM\n#>  P hms                  1.1.3      2023-03-21 [?] RSPM\n#>  P htmltools            0.5.8.1    2024-04-04 [?] RSPM (R 4.5.0)\n#>  P htmlwidgets          1.6.4      2023-12-06 [?] RSPM\n#>  P httpuv               1.6.16     2025-04-16 [?] RSPM\n#>  P httr                 1.4.7      2023-08-15 [?] RSPM\n#>  P jsonlite             2.0.0      2025-03-27 [?] RSPM (R 4.5.0)\n#>  P KernSmooth           2.23-26    2025-01-01 [?] CRAN (R 4.4.2)\n#>  P knitr                1.50       2025-03-16 [?] RSPM\n#>  P later                1.4.2      2025-04-08 [?] RSPM\n#>  P lattice              0.22-5     2023-10-24 [?] CRAN (R 4.3.3)\n#>  P leafem               0.2.4      2025-05-01 [?] RSPM\n#>  P leaflet              2.2.2      2024-03-26 [?] RSPM\n#>  P lifecycle            1.0.4      2023-11-07 [?] RSPM (R 4.5.0)\n#>  P lubridate          * 1.9.4      2024-12-08 [?] RSPM\n#>  P magrittr             2.0.3      2022-03-30 [?] RSPM (R 4.5.0)\n#>  P mapview              2.11.2     2023-10-13 [?] RSPM\n#>  P memoise              2.0.1      2021-11-26 [?] RSPM (R 4.5.0)\n#>  P mime                 0.13       2025-03-17 [?] RSPM\n#>  P miniUI               0.1.2      2025-04-17 [?] RSPM (R 4.5.0)\n#>  P pillar               1.10.2     2025-04-05 [?] RSPM\n#>  P pkgbuild             1.4.8      2025-05-26 [?] RSPM (R 4.5.0)\n#>  P pkgconfig            2.0.3      2019-09-22 [?] RSPM (R 4.5.0)\n#>  P pkgload              1.4.0      2024-06-28 [?] RSPM\n#>  P png                  0.1-8      2022-11-29 [?] RSPM\n#>  P processx             3.8.6      2025-02-21 [?] RSPM\n#>  P profvis              0.4.0      2024-09-20 [?] RSPM (R 4.5.0)\n#>  P promises             1.3.3      2025-05-29 [?] RSPM (R 4.5.0)\n#>  P proxy                0.4-27     2022-06-09 [?] RSPM (R 4.5.0)\n#>  P ps                   1.9.1      2025-04-12 [?] RSPM\n#>  P purrr              * 1.0.4      2025-02-05 [?] RSPM\n#>  P quarto             * 1.4.4      2024-07-20 [?] RSPM\n#>  P R6                   2.6.1      2025-02-15 [?] RSPM (R 4.5.0)\n#>  P raster               3.6-32     2025-03-28 [?] RSPM\n#>  P RColorBrewer         1.1-3      2022-04-03 [?] RSPM (R 4.5.0)\n#>  P Rcpp                 1.0.14     2025-01-12 [?] CRAN (R 4.5.0)\n#>  P readr              * 2.1.5      2024-01-10 [?] RSPM\n#>  P remotes              2.5.0      2024-03-17 [?] RSPM\n#>  P renv                 1.1.4      2025-03-20 [?] RSPM\n#>  P rlang                1.1.6      2025-04-11 [?] RSPM\n#>  P rmarkdown            2.29       2024-11-04 [?] RSPM\n#>  P rnaturalearth        1.0.1      2023-12-15 [?] RSPM\n#>  P rnaturalearthhires * 1.0.0.9000 2025-04-15 [?] Github (ropensci/rnaturalearthhires@153b0ea)\n#>  P rstudioapi           0.17.1     2024-10-22 [?] RSPM\n#>  P Rttf2pt1             1.3.12     2023-01-22 [?] RSPM (R 4.5.0)\n#>  P s2                   1.1.9      2025-05-23 [?] RSPM\n#>  P satellite            1.0.5      2024-02-10 [?] RSPM\n#>  P scales               1.4.0      2025-04-24 [?] RSPM\n#>  P sessioninfo          1.2.3      2025-02-05 [?] RSPM (R 4.5.0)\n#>  P sf                 * 1.0-21     2025-05-15 [?] RSPM\n#>  P shiny                1.10.0     2024-12-14 [?] RSPM (R 4.5.0)\n#>  P sp                   2.2-0      2025-02-01 [?] RSPM\n#>  P stringi              1.8.7      2025-03-27 [?] RSPM\n#>  P stringr            * 1.5.1      2023-11-14 [?] RSPM (R 4.5.0)\n#>  P terra                1.8-54     2025-06-01 [?] RSPM\n#>  P tibble             * 3.3.0      2025-06-08 [?] RSPM (R 4.5.0)\n#>  P tidyr              * 1.3.1      2024-01-24 [?] RSPM (R 4.5.0)\n#>  P tidyselect           1.2.1      2024-03-11 [?] RSPM (R 4.5.0)\n#>  P tidyverse          * 2.0.0      2023-02-22 [?] RSPM\n#>  P timechange           0.3.0      2024-01-18 [?] RSPM\n#>  P tzdb                 0.5.0      2025-03-15 [?] RSPM\n#>  P units                0.8-7      2025-03-11 [?] RSPM\n#>  P urlchecker           1.0.1      2021-11-30 [?] RSPM (R 4.5.0)\n#>  P usethis              3.1.0      2024-11-26 [?] RSPM (R 4.5.0)\n#>  P utf8                 1.2.6      2025-06-08 [?] RSPM (R 4.5.0)\n#>  P vctrs                0.6.5      2023-12-01 [?] RSPM (R 4.5.0)\n#>  P withr                3.0.2      2024-10-28 [?] RSPM\n#>  P wk                   0.9.4      2024-10-11 [?] RSPM\n#>  P xfun                 0.52       2025-04-02 [?] RSPM\n#>  P xtable               1.8-4      2019-04-21 [?] RSPM (R 4.5.0)\n#>  P yaml                 2.3.10     2024-07-26 [?] RSPM\n#> \n#>  [1] /tmp/RtmpZPTuyN/renv-use-libpath-279bb9681aab5f\n#>  [2] /home/filoche/.cache/R/renv/sandbox/linux-linuxmint-noble/R-4.5/x86_64-pc-linux-gnu/9a444a72\n#> \n#>  * ── Packages attached to the search path.\n#>  P ── Loaded and on-disk path mismatch.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n\n\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}