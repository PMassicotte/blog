{
  "hash": "f6bae7c9e58a0877845e128ff5844dd8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Separating/exploding spatial features with R'\nauthor: 'Philippe Massicotte'\ndate: '2023-08-15'\ncategories: [R, rspatial, Geospatial]\n# the preview file needs to be named preview.png\n# mogrify -format png preview.jpg\n# https://quarto.org/docs/websites/website-tools.html#preview-images\neditor_options:\n  chunk_output_type: console\ncitation: true\n---\n\n\n\n\n\n\nIt has been a while since I posted something! But today I wanted to quickly experiment and create a map where I could separate/explode the spatial geometries. Let's first download the polygon data for Canada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tidyverse)\n\ncanada <- rnaturalearth::ne_states(country = \"canada\", returnclass = \"sf\") |>\n  st_make_valid()\n#> \n#> ── R CMD build ─────────────────────────────────────────────────────────────────\n#> * checking for file ‘/tmp/RtmpwyVqRL/remotes2fbb24690b6b27/ropensci-rnaturalearthhires-dd1e210/DESCRIPTION’ ... OK\n#> * preparing ‘rnaturalearthhires’:\n#> * checking DESCRIPTION meta-information ... OK\n#> * checking for LF line-endings in source and make files and shell scripts\n#> * checking for empty or unneeded directories\n#> * building ‘rnaturalearthhires_1.0.0.9000.tar.gz’\n```\n:::\n\n\nAs we can see, there are three different regions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada |>\n  distinct(region)\n#>            region\n#> 1  Western Canada\n#> 2  Eastern Canada\n#> 3 Northern Canada\n```\n:::\n\n\nThese regions can be visualized using `ggplot2` and `sf`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get a good CRS for Canada\ncrsuggest::suggest_crs(canada)\n#> # A tibble: 10 × 6\n#>    crs_code crs_name                        crs_type crs_gcs crs_units crs_proj4\n#>    <chr>    <chr>                           <chr>      <dbl> <chr>     <chr>    \n#>  1 5931     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  2 3979     NAD83(CSRS) / Canada Atlas Lam… project…    4617 m         +proj=lc…\n#>  3 3978     NAD83 / Canada Atlas Lambert    project…    4269 m         +proj=lc…\n#>  4 3348     NAD83(CSRS) / Statistics Canad… project…    4617 m         +proj=lc…\n#>  5 3347     NAD83 / Statistics Canada Lamb… project…    4269 m         +proj=lc…\n#>  6 5926     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  7 5921     WGS 84 / EPSG Arctic Regional … project…    4326 m         +proj=lc…\n#>  8 6350     NAD83(2011) / Conus Albers      project…    6318 m         +proj=ae…\n#>  9 5072     NAD83(NSRS2007) / Conus Albers  project…    4759 m         +proj=ae…\n#> 10 5071     NAD83(HARN) / Conus Albers      project…    4152 m         +proj=ae…\n\ncanada <- canada |>\n  st_transform(5931)\n\ncanada |>\n  ggplot(aes(fill = region)) +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png)\n:::\n:::\n\n\nWith this following code, we can find the centroid of each region and shift the centers of the new polygons.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada_exploded <- canada |>\n  group_by(region) |>\n  mutate(region_centroid = st_centroid(st_union(geometry))) |>\n  ungroup() |>\n  mutate(geometry = (geometry - region_centroid) * 0.9 + region_centroid)\n\nst_crs(canada_exploded)\n#> Coordinate Reference System: NA\n```\n:::\n\n\nAs seen above, for a reason I do not know, we have lost the CRS after the operation, so I have to set it back before visualizing it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncanada_exploded <- canada_exploded |>\n  st_set_crs(5931)\n\ncanada_exploded |>\n  ggplot(aes(fill = region)) +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png)\n:::\n:::\n\n\nBonus: if we want to get a little bit more fancy, we can add shadows with `ggfx`:\n\n\n::: {.cell .preview-image}\n\n```{.r .cell-code}\nlibrary(ggfx)\n\ncanada_exploded |>\n  ggplot(aes(fill = region)) +\n  with_shadow(\n    geom_sf(),\n    sigma = 5,\n    x_offset = 20,\n    y_offset = 20\n  ) +\n  theme(\n    legend.position = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png)\n:::\n:::\n\n\n<details>\n  \n<summary>Session info</summary>\n\n\n::: {.cell}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.4.0 (2024-04-24)\n#>  os       Ubuntu 24.04 LTS\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Toronto\n#>  date     2024-05-02\n#>  pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  ! package            * version    date (UTC) lib source\n#>  P base64enc            0.1-3      2015-07-28 [?] RSPM (R 4.4.0)\n#>  P cachem               1.0.8      2023-05-01 [?] RSPM (R 4.4.0)\n#>  P callr                3.7.6      2024-03-25 [?] RSPM (R 4.4.0)\n#>  P class                7.3-22     2023-05-03 [?] CRAN (R 4.4.0)\n#>  P classInt             0.4-10     2023-09-05 [?] RSPM (R 4.4.0)\n#>  P cli                  3.6.2      2023-12-11 [?] RSPM (R 4.4.0)\n#>  P codetools            0.2-20     2024-03-31 [?] CRAN (R 4.4.0)\n#>  P colorspace           2.1-0      2023-01-23 [?] RSPM (R 4.4.0)\n#>  P crosstalk            1.2.1      2023-11-23 [?] RSPM (R 4.4.0)\n#>  P crsuggest            0.4        2022-07-06 [?] RSPM (R 4.4.0)\n#>  P curl                 5.2.1      2024-03-01 [?] RSPM (R 4.4.0)\n#>  P DBI                  1.2.2      2024-02-16 [?] RSPM (R 4.4.0)\n#>  P desc                 1.4.3      2023-12-10 [?] RSPM (R 4.4.0)\n#>  P devtools             2.4.5      2022-10-11 [?] RSPM\n#>  P digest               0.6.35     2024-03-11 [?] RSPM (R 4.4.0)\n#>  P dplyr              * 1.1.4      2023-11-17 [?] RSPM (R 4.4.0)\n#>  P e1071                1.7-14     2023-12-06 [?] RSPM (R 4.4.0)\n#>  P ellipsis             0.3.2      2021-04-29 [?] RSPM (R 4.4.0)\n#>  P evaluate             0.23       2023-11-01 [?] RSPM (R 4.4.0)\n#>  P extrafont            0.19       2023-01-18 [?] RSPM (R 4.4.0)\n#>  P extrafontdb          1.0        2012-06-11 [?] RSPM (R 4.4.0)\n#>  P fansi                1.0.6      2023-12-08 [?] RSPM (R 4.4.0)\n#>  P farver               2.1.1      2022-07-06 [?] CRAN (R 4.4.0)\n#>  P fastmap              1.1.1      2023-02-24 [?] RSPM (R 4.4.0)\n#>  P forcats            * 1.0.0      2023-01-29 [?] RSPM (R 4.4.0)\n#>  P fs                   1.6.4      2024-04-25 [?] CRAN (R 4.4.0)\n#>  P generics             0.1.3      2022-07-05 [?] RSPM (R 4.4.0)\n#>  P ggfx               * 1.0.1      2022-08-22 [?] RSPM (R 4.4.0)\n#>  P ggplot2            * 3.5.1      2024-04-23 [?] RSPM (R 4.4.0)\n#>  P ggpmthemes         * 0.0.2      2024-05-02 [?] Github (pmassicotte/ggpmthemes@993d61e)\n#>  P glue                 1.7.0      2024-01-09 [?] RSPM (R 4.4.0)\n#>  P gtable               0.3.5      2024-04-22 [?] RSPM (R 4.4.0)\n#>  P hms                  1.1.3      2023-03-21 [?] RSPM (R 4.4.0)\n#>  P htmltools            0.5.8.1    2024-04-04 [?] RSPM (R 4.4.0)\n#>  P htmlwidgets          1.6.4      2023-12-06 [?] RSPM\n#>  P httpuv               1.6.15     2024-03-26 [?] RSPM (R 4.4.0)\n#>  P httr                 1.4.7      2023-08-15 [?] RSPM (R 4.4.0)\n#>  P jsonlite             1.8.8      2023-12-04 [?] RSPM (R 4.4.0)\n#>  P KernSmooth           2.23-22    2023-07-10 [?] CRAN (R 4.4.0)\n#>  P knitr                1.46       2024-04-06 [?] RSPM (R 4.4.0)\n#>  P later                1.3.2      2023-12-06 [?] RSPM (R 4.4.0)\n#>  P lattice              0.22-6     2024-03-20 [?] CRAN (R 4.4.0)\n#>  P leafem               0.2.3      2023-09-17 [?] RSPM (R 4.4.0)\n#>  P leaflet              2.2.2      2024-03-26 [?] RSPM (R 4.4.0)\n#>  P lifecycle            1.0.4      2023-11-07 [?] RSPM (R 4.4.0)\n#>  P lubridate          * 1.9.3      2023-09-27 [?] RSPM (R 4.4.0)\n#>  P magick               2.8.3      2024-02-18 [?] RSPM (R 4.4.0)\n#>  P magrittr             2.0.3      2022-03-30 [?] RSPM (R 4.4.0)\n#>  P mapview              2.11.2     2023-10-13 [?] RSPM (R 4.4.0)\n#>  P memoise              2.0.1      2021-11-26 [?] RSPM (R 4.4.0)\n#>  P mime                 0.12       2021-09-28 [?] RSPM (R 4.4.0)\n#>  P miniUI               0.1.1.1    2018-05-18 [?] RSPM (R 4.4.0)\n#>  P munsell              0.5.1      2024-04-01 [?] CRAN (R 4.4.0)\n#>  P pillar               1.9.0      2023-03-22 [?] RSPM (R 4.4.0)\n#>  P pkgbuild             1.4.4      2024-03-17 [?] RSPM (R 4.4.0)\n#>  P pkgconfig            2.0.3      2019-09-22 [?] RSPM (R 4.4.0)\n#>  P pkgload              1.3.4      2024-01-16 [?] RSPM\n#>  P png                  0.1-8      2022-11-29 [?] RSPM (R 4.4.0)\n#>  P processx             3.8.4      2024-03-16 [?] RSPM (R 4.4.0)\n#>  P profvis              0.3.8      2023-05-02 [?] RSPM\n#>  P promises             1.3.0      2024-04-05 [?] RSPM (R 4.4.0)\n#>  P proxy                0.4-27     2022-06-09 [?] RSPM (R 4.4.0)\n#>  P ps                   1.7.6      2024-01-18 [?] RSPM (R 4.4.0)\n#>  P purrr              * 1.0.2      2023-08-10 [?] RSPM (R 4.4.0)\n#>  P quarto             * 1.4        2024-03-06 [?] RSPM\n#>  P R.cache              0.16.0     2022-07-21 [?] RSPM\n#>  P R.methodsS3          1.8.2      2022-06-13 [?] RSPM\n#>  P R.oo                 1.26.0     2024-01-24 [?] RSPM\n#>  P R.utils              2.12.3     2023-11-18 [?] RSPM\n#>  P R6                   2.5.1      2021-08-19 [?] RSPM (R 4.4.0)\n#>  P ragg                 1.3.0      2024-03-13 [?] RSPM\n#>  P raster               3.6-26     2023-10-14 [?] RSPM (R 4.4.0)\n#>  P Rcpp                 1.0.12     2024-01-09 [?] RSPM (R 4.4.0)\n#>  P readr              * 2.1.5      2024-01-10 [?] RSPM (R 4.4.0)\n#>  P remotes              2.5.0      2024-03-17 [?] RSPM\n#>  P renv                 1.0.7      2024-04-11 [?] RSPM (R 4.4.0)\n#>  P rlang                1.1.3      2024-01-10 [?] RSPM (R 4.4.0)\n#>  P rmarkdown            2.26       2024-03-05 [?] RSPM (R 4.4.0)\n#>  P rnaturalearth        1.0.1      2023-12-15 [?] RSPM\n#>    rnaturalearthhires   1.0.0.9000 2024-05-02 [1] Github (ropensci/rnaturalearthhires@dd1e210)\n#>  P rstudioapi           0.16.0     2024-03-24 [?] RSPM\n#>  P Rttf2pt1             1.3.12     2023-01-22 [?] RSPM (R 4.4.0)\n#>  P s2                   1.1.6      2023-12-19 [?] RSPM (R 4.4.0)\n#>  P satellite            1.0.5      2024-02-10 [?] RSPM (R 4.4.0)\n#>  P scales               1.3.0      2023-11-28 [?] CRAN (R 4.4.0)\n#>  P sessioninfo          1.2.2      2021-12-06 [?] RSPM\n#>  P sf                 * 1.0-16     2024-03-24 [?] RSPM (R 4.4.0)\n#>  P shiny                1.8.1.1    2024-04-02 [?] RSPM (R 4.4.0)\n#>  P sp                   2.1-4      2024-04-30 [?] RSPM\n#>  P stringi              1.8.3      2023-12-11 [?] RSPM (R 4.4.0)\n#>  P stringr            * 1.5.1      2023-11-14 [?] RSPM (R 4.4.0)\n#>  P styler             * 1.10.3     2024-04-07 [?] RSPM\n#>  P systemfonts          1.0.6      2024-03-07 [?] RSPM (R 4.4.0)\n#>  P terra                1.7-71     2024-01-31 [?] CRAN (R 4.4.0)\n#>  P textshaping          0.3.7      2023-10-09 [?] RSPM\n#>  P tibble             * 3.2.1      2023-03-20 [?] RSPM (R 4.4.0)\n#>  P tidyr              * 1.3.1      2024-01-24 [?] RSPM (R 4.4.0)\n#>  P tidyselect           1.2.1      2024-03-11 [?] RSPM (R 4.4.0)\n#>  P tidyverse          * 2.0.0      2023-02-22 [?] RSPM (R 4.4.0)\n#>  P timechange           0.3.0      2024-01-18 [?] RSPM (R 4.4.0)\n#>  P tzdb                 0.4.0      2023-05-12 [?] RSPM (R 4.4.0)\n#>  P units                0.8-5      2023-11-28 [?] RSPM (R 4.4.0)\n#>  P urlchecker           1.0.1      2021-11-30 [?] RSPM\n#>  P usethis              2.2.3      2024-02-19 [?] RSPM\n#>  P utf8                 1.2.4      2023-10-22 [?] RSPM (R 4.4.0)\n#>  P vctrs                0.6.5      2023-12-01 [?] RSPM (R 4.4.0)\n#>  P withr                3.0.0      2024-01-16 [?] RSPM (R 4.4.0)\n#>  P wk                   0.9.1      2023-11-29 [?] RSPM (R 4.4.0)\n#>  P xfun                 0.43       2024-03-25 [?] RSPM (R 4.4.0)\n#>  P xtable               1.8-4      2019-04-21 [?] RSPM (R 4.4.0)\n#>  P yaml                 2.3.8      2023-12-11 [?] RSPM (R 4.4.0)\n#> \n#>  [1] /tmp/RtmpwyVqRL/renv-use-libpath-2fbb2417a8ef72\n#>  [2] /home/filoche/.cache/R/renv/sandbox/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/a71ef467\n#> \n#>  P ── Loaded and on-disk path mismatch.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}