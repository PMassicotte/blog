{
  "hash": "63b2f25514e72b26e7f022c461015e35",
  "result": {
    "markdown": "---\ntitle: \"Segmenting linestring into points of equal distance\"\nauthor: \"Philippe Massicotte\"\ndate: \"2023-09-26\"\ncategories: [R, sf, geospatial, rspatial]\n# The preview file needs to be named preview.png\n# mogrify -format png preview.jpg\n# https://quarto.org/docs/websites/website-tools.html#preview-images\nimage: \"img/preview.png\" \neditor_options: \n  chunk_output_type: console\ncitation: true\n---\n\n\n\n\n\n\nThis will be a quick one, but I thought it was worth sharing (at least for future me). I was recently trying to segment a line into points of equal distances. I must say that I spent too much time with the `st_segmentize()` function. I found that I would simply achieve this using `st_line_sample()`. Let me show you how.\n\n![When your brain is super well synchronized with your camera’s retadator.](img/preview.png){width=85%}\n\n<center>Photo by <a href=\"https://unsplash.com/@arizonanthony?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Anthony Cantin</a> on <a href=\"https://unsplash.com/photos/HtM6I5_jR6o?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></center>\n\nFirst, I will read a KML file containing the path of the [CCGS Amundsen](https://amundsenscience.com/). I will then transform the data into a polar projection.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nsf_use_s2(TRUE)\n\npath <- st_read(\"https://data.amundsen.ulaval.ca/NAV_Amundsen.kml\") |>\n  st_transform(3413)\n#> Reading layer `\n#> D:\\Remote_data\\NAV_Amundsen.kml\n#> ' from data source \n#>   `https://data.amundsen.ulaval.ca/NAV_Amundsen.kml' using driver `LIBKML'\n#> Simple feature collection with 1 feature and 11 fields\n#> Geometry type: LINESTRING\n#> Dimension:     XYZ\n#> Bounding box:  xmin: -94.81074 ymin: 74.36479 xmax: -61.2221 ymax: 82.15542\n#> z_range:       zmin: 1 zmax: 1\n#> Geodetic CRS:  WGS 84\n\n# We can see that the path is a linestring\npath\n#> Simple feature collection with 1 feature and 11 fields\n#> Geometry type: LINESTRING\n#> Dimension:     XYZ\n#> Bounding box:  xmin: -1288927 ymin: -1380465 xmax: -237801 ymax: -817160\n#> z_range:       zmin: 1 zmax: 1\n#> Projected CRS: WGS 84 / NSIDC Sea Ice Polar Stereographic North\n#>          Name description timestamp begin  end  altitudeMode tessellate extrude\n#> 1 \\nge_plot\\n        \\n\\n      <NA>  <NA> <NA> clampToGround          1       0\n#>   visibility drawOrder icon                       geometry\n#> 1          1        NA <NA> LINESTRING Z (-1281463 -108...\n\nst_length(path)\n#> 9378924 [m]\n```\n:::\n\n\nJust for fun, let's visualize it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npath |>\n  ggplot() +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png)\n:::\n:::\n\nNow is the fun part I discovered. You can use the `density` argument of the `st_line_sample()` function to convert a LINESTRING into points of equal distances, let's say 50 kilometres. Note that the new geometry is MULTIPOINT.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npts <- st_line_sample(path, density = units::as_units(50,\"km\")) \n\npts\n#> Geometry set for 1 feature \n#> Geometry type: MULTIPOINT\n#> Dimension:     XYZ\n#> Bounding box:  xmin: -1288893 ymin: -1379918 xmax: -243102.4 ymax: -827232.7\n#> z_range:       zmin: 1 zmax: 1\n#> Projected CRS: WGS 84 / NSIDC Sea Ice Polar Stereographic North\n\npts |>\n  ggplot() +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png)\n:::\n:::\n\n\nWe can verify that we have roughly 50 km between each point.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npts |>\n  st_cast(\"POINT\") |>\n  st_as_sf() |>\n  mutate(dist = st_distance(x, lag(x), by_element = TRUE))\n#> Simple feature collection with 188 features and 1 field\n#> Geometry type: POINT\n#> Dimension:     XYZ\n#> Bounding box:  xmin: -1288893 ymin: -1379918 xmax: -243102.4 ymax: -827232.7\n#> Projected CRS: WGS 84 / NSIDC Sea Ice Polar Stereographic North\n#> First 10 features:\n#>                                 x         dist\n#> 1   POINT Z (-1288893 -1106180 1)       NA [m]\n#> 2   POINT Z (-1253136 -1140616 1) 49643.14 [m]\n#> 3   POINT Z (-1216173 -1174081 1) 49861.19 [m]\n#> 4   POINT Z (-1183600 -1211563 1) 49658.19 [m]\n#> 5   POINT Z (-1152064 -1249133 1) 49050.55 [m]\n#> 6   POINT Z (-1115940 -1283394 1) 49787.61 [m]\n#> 7   POINT Z (-1079930 -1317714 1) 49744.42 [m]\n#> 8   POINT Z (-1039870 -1347315 1) 49810.48 [m]\n#> 9  POINT Z (-994937.7 -1366917 1) 49021.91 [m]\n#> 10 POINT Z (-947811.5 -1379918 1) 48886.61 [m]\n```\n:::\n\n\n<details>\n  \n<summary>Session info</summary>\n\n\n::: {.cell}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.3.1 (2023-06-16)\n#>  os       Linux Mint 21.2\n#>  system   x86_64, linux-gnu\n#>  ui       X11\n#>  language en_CA:en\n#>  collate  en_CA.UTF-8\n#>  ctype    en_CA.UTF-8\n#>  tz       America/Montreal\n#>  date     2023-09-29\n#>  pandoc   2.9.2.1 @ /usr/bin/ (via rmarkdown)\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────\n#>  !  package     * version date (UTC) lib source\n#>  P  cachem        1.0.8   2023-05-01 [?] RSPM (R 4.3.0)\n#>  P  callr         3.7.3   2022-11-02 [?] RSPM (R 4.3.0)\n#>  P  class         7.3-22  2023-05-03 [?] CRAN (R 4.3.1)\n#>  P  classInt      0.4-10  2023-09-05 [?] RSPM (R 4.3.1)\n#>  P  cli           3.6.1   2023-03-23 [?] RSPM (R 4.3.0)\n#>  P  colorspace    2.1-0   2023-01-23 [?] RSPM (R 4.3.0)\n#>  P  crayon        1.5.2   2022-09-29 [?] RSPM (R 4.3.0)\n#>  P  DBI           1.1.3   2022-06-18 [?] RSPM (R 4.3.0)\n#>  P  devtools      2.4.5   2022-10-11 [?] RSPM (R 4.3.0)\n#>  P  digest        0.6.33  2023-07-07 [?] RSPM (R 4.3.1)\n#>  P  dplyr       * 1.1.3   2023-09-03 [?] RSPM (R 4.3.1)\n#>  P  e1071         1.7-13  2023-02-01 [?] RSPM (R 4.3.0)\n#>  P  ellipsis      0.3.2   2021-04-29 [?] RSPM (R 4.3.0)\n#>  P  evaluate      0.21    2023-05-05 [?] RSPM (R 4.3.0)\n#>  P  extrafont     0.19    2023-01-18 [?] RSPM (R 4.3.0)\n#>  P  extrafontdb   1.0     2012-06-11 [?] RSPM (R 4.3.0)\n#>  P  fansi         1.0.4   2023-01-22 [?] RSPM (R 4.3.0)\n#>  P  farver        2.1.1   2022-07-06 [?] RSPM (R 4.3.0)\n#>  P  fastmap       1.1.1   2023-02-24 [?] RSPM (R 4.3.0)\n#>  P  forcats     * 1.0.0   2023-01-29 [?] RSPM (R 4.3.0)\n#>  P  fs            1.6.3   2023-07-20 [?] RSPM (R 4.3.1)\n#>  P  generics      0.1.3   2022-07-05 [?] RSPM (R 4.3.0)\n#>  P  ggplot2     * 3.4.3   2023-08-14 [?] RSPM (R 4.3.1)\n#>  P  ggpmthemes  * 0.0.2   2023-05-01 [?] Github (PMassicotte/ggpmthemes@993d61e)\n#>  P  glue          1.6.2   2022-02-24 [?] RSPM (R 4.3.0)\n#>  P  gtable        0.3.4   2023-08-21 [?] RSPM (R 4.3.1)\n#>  P  hms           1.1.3   2023-03-21 [?] RSPM (R 4.3.0)\n#>  P  htmltools     0.5.6   2023-08-10 [?] RSPM (R 4.3.1)\n#>  P  htmlwidgets   1.6.2   2023-03-17 [?] RSPM (R 4.3.0)\n#>  P  httpuv        1.6.11  2023-05-11 [?] RSPM (R 4.3.0)\n#>  P  jsonlite      1.8.7   2023-06-29 [?] RSPM (R 4.3.0)\n#>  P  KernSmooth    2.23-22 2023-07-10 [?] CRAN (R 4.3.1)\n#>  P  knitr         1.44    2023-09-11 [?] RSPM (R 4.3.1)\n#>  P  later         1.3.1   2023-05-02 [?] RSPM (R 4.3.0)\n#>  P  lifecycle     1.0.3   2022-10-07 [?] RSPM (R 4.3.0)\n#>  P  lubridate   * 1.9.2   2023-02-10 [?] RSPM (R 4.3.0)\n#>  P  magrittr      2.0.3   2022-03-30 [?] RSPM (R 4.3.0)\n#>  P  memoise       2.0.1   2021-11-26 [?] RSPM (R 4.3.0)\n#>  P  mime          0.12    2021-09-28 [?] RSPM (R 4.3.0)\n#>  P  miniUI        0.1.1.1 2018-05-18 [?] RSPM (R 4.3.0)\n#>  P  munsell       0.5.0   2018-06-12 [?] RSPM (R 4.3.0)\n#>  P  pillar        1.9.0   2023-03-22 [?] RSPM (R 4.3.0)\n#>  P  pkgbuild      1.4.2   2023-06-26 [?] RSPM (R 4.3.1)\n#>  P  pkgconfig     2.0.3   2019-09-22 [?] RSPM (R 4.3.0)\n#>  P  pkgload       1.3.3   2023-09-22 [?] RSPM (R 4.3.1)\n#>  P  prettyunits   1.2.0   2023-09-24 [?] RSPM (R 4.3.1)\n#>  P  processx      3.8.2   2023-06-30 [?] RSPM (R 4.3.1)\n#>  P  profvis       0.3.8   2023-05-02 [?] RSPM (R 4.3.0)\n#>  P  promises      1.2.1   2023-08-10 [?] RSPM (R 4.3.1)\n#>  P  proxy         0.4-27  2022-06-09 [?] RSPM (R 4.3.0)\n#>  P  ps            1.7.5   2023-04-18 [?] RSPM (R 4.3.0)\n#>  P  purrr       * 1.0.2   2023-08-10 [?] RSPM (R 4.3.1)\n#>  P  R6            2.5.1   2021-08-19 [?] RSPM (R 4.3.0)\n#>  P  Rcpp          1.0.11  2023-07-06 [?] RSPM (R 4.3.1)\n#>  P  readr       * 2.1.4   2023-02-10 [?] RSPM (R 4.3.0)\n#>  P  remotes       2.4.2.1 2023-07-18 [?] RSPM (R 4.3.1)\n#>  VP renv          1.0.2   2023-09-19 [?] RSPM (R 4.3.1) (on disk 1.0.3)\n#>  P  rlang         1.1.1   2023-04-28 [?] RSPM (R 4.3.0)\n#>  VP rmarkdown     2.24    2023-09-18 [?] RSPM (R 4.3.1) (on disk 2.25)\n#>  P  rstudioapi    0.15.0  2023-07-07 [?] RSPM (R 4.3.1)\n#>  P  Rttf2pt1      1.3.12  2023-01-22 [?] RSPM (R 4.3.0)\n#>  P  scales        1.2.1   2022-08-20 [?] RSPM (R 4.3.0)\n#>  P  sessioninfo   1.2.2   2021-12-06 [?] RSPM (R 4.3.0)\n#>  P  sf          * 1.0-14  2023-07-11 [?] CRAN (R 4.3.1)\n#>  P  shiny         1.7.5   2023-08-12 [?] RSPM (R 4.3.1)\n#>  P  stringi       1.7.12  2023-01-11 [?] CRAN (R 4.3.1)\n#>  P  stringr     * 1.5.0   2022-12-02 [?] RSPM (R 4.3.0)\n#>  P  tibble      * 3.2.1   2023-03-20 [?] RSPM (R 4.3.0)\n#>  P  tidyr       * 1.3.0   2023-01-24 [?] RSPM (R 4.3.0)\n#>  P  tidyselect    1.2.0   2022-10-10 [?] RSPM (R 4.3.0)\n#>  P  tidyverse   * 2.0.0   2023-02-22 [?] RSPM (R 4.3.0)\n#>  P  timechange    0.2.0   2023-01-11 [?] RSPM (R 4.3.0)\n#>  P  tzdb          0.4.0   2023-05-12 [?] RSPM (R 4.3.0)\n#>  P  units         0.8-4   2023-09-13 [?] RSPM (R 4.3.1)\n#>  P  urlchecker    1.0.1   2021-11-30 [?] RSPM (R 4.3.0)\n#>  P  usethis       2.2.2   2023-07-06 [?] RSPM (R 4.3.1)\n#>  P  utf8          1.2.3   2023-01-31 [?] RSPM (R 4.3.0)\n#>  P  vctrs         0.6.3   2023-06-14 [?] RSPM (R 4.3.0)\n#>  P  withr         2.5.0   2022-03-03 [?] RSPM (R 4.3.0)\n#>  P  xfun          0.40    2023-08-09 [?] RSPM (R 4.3.1)\n#>  P  xtable        1.8-4   2019-04-21 [?] RSPM (R 4.3.0)\n#>  P  yaml          2.3.7   2023-01-23 [?] RSPM (R 4.3.0)\n#> \n#>  [1] /tmp/Rtmpmxfyuh/renv-use-libpath-92a66212b21ac\n#>  [2] /home/filoche/.cache/R/renv/sandbox/R-4.3/x86_64-pc-linux-gnu/9a444a72\n#> \n#>  V ── Loaded and on-disk version mismatch.\n#>  P ── Loaded and on-disk path mismatch.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n\n\n</details>\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}