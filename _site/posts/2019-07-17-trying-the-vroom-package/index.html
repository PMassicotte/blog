<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Philippe Massicotte">
<meta name="dcterms.date" content="2019-07-17">
<title>Welcome to my blog - Trying the new R vroom Package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Welcome to my blog</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">Publications</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html">Presentations</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../workshops.html">Workshops and teaching</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pmassicotte"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/philmassicotte"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../users/5558188/philippe-massicotte"><i class="bi bi-stack-overflow" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Trying the new R vroom Package</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">packages</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Philippe Massicotte </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 17, 2019</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>Many R packages can be used to read plain rectangular data files. Among them, <code>readr</code> and <code>data.table</code> are quite popular options. Recently, the <a href="https://github.com/r-lib/vroom">vroom</a> package have been published on CRAN by <a href="https://twitter.com/jimhester_?lang=en">Jim Hester</a>. While I do not know much about the technology behind the scene, Jim says:</p>
<blockquote class="blockquote">
<p>But that’s impossible! How can it be so fast?</p>
<p>vroom doesn’t stop to actually read all of your data, it simply indexes where each record is located so it can be read later. The vectors returned use the Altrep framework to lazily load the data on-demand when it is accessed, so you only pay for what you use. This lazy access is done automatically, so no changes to your R data-manipulation code are needed.</p>
</blockquote>
<p>Because I often have to read large data files, I decided to try this new promising package.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_28aad3e26197ca1951385496904bd93b">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vroom.r-lib.org">vroom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PMassicotte/ggpmthemes">ggpmthemes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggpmthemes/man/theme_poppins.html">theme_poppins</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next sections, I will compare several methods to read a plain CSV file. The file I will be using contains bike commute data from <a href="https://www.capitalbikeshare.com/system-data">capital bike share</a>. The file contains roughly 170 000 observations and 9 variables.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_ac174870f192daf7a24d85570c347001">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html">curl_download</a></span><span class="op">(</span><span class="st">"https://s3.amazonaws.com/capitalbikeshare-data/201801-capitalbikeshare-tripdata.zip"</span>, destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".zip"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="va">file</span>, exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 168590 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Start station, End station, Bike number, Member type
dbl  (3): Duration, Start station number, End station number
dttm (2): Start date, End date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 168,590 × 9
   Duration `Start date`        `End date`          Start stat…¹ Start…² End s…³
      &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;                     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
 1      552 2018-01-01 00:05:06 2018-01-01 00:14:18        31104 Adams …   31400
 2     1282 2018-01-01 00:14:30 2018-01-01 00:35:53        31321 15th S…   31321
 3     1265 2018-01-01 00:14:53 2018-01-01 00:35:58        31321 15th S…   31321
 4      578 2018-01-01 00:15:31 2018-01-01 00:25:09        31406 14th &amp;…   31103
 5      372 2018-01-01 00:18:02 2018-01-01 00:24:15        31618 4th &amp; …   31619
 6      369 2018-01-01 00:18:07 2018-01-01 00:24:17        31618 4th &amp; …   31619
 7      486 2018-01-01 00:19:07 2018-01-01 00:27:14        31042 Market…   31098
 8     1615 2018-01-01 00:21:55 2018-01-01 00:48:50        31042 Market…   31045
 9     1598 2018-01-01 00:22:02 2018-01-01 00:48:41        31042 Market…   31045
10      483 2018-01-01 00:22:10 2018-01-01 00:30:14        31115 Columb…   31509
# … with 168,580 more rows, 3 more variables: `End station` &lt;chr&gt;,
#   `Bike number` &lt;chr&gt;, `Member type` &lt;chr&gt;, and abbreviated variable names
#   ¹​`Start station number`, ²​`Start station`, ³​`End station number`
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>Because the <code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom()</a></code> function can use a vector of files, I will duplicate <code>file</code> 10 times.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_0f4507b27bb657e8d75dffffc749f28a">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">file</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">files</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [2] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [3] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [4] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [5] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [6] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [7] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [8] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
 [9] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"
[10] "/tmp/RtmpMRMqo4/201801_capitalbikeshare_tripdata.csv"</code></pre>
</div>
</div>
<p>I can now simply use this character vector with <code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom()</a></code>. Note that I can also use the <code>.name_repair</code> argument to clean column names.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_a270ca4ce0a5bab12323e65af8cb9056">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="va">files</span>, .name_repair <span class="op">=</span> <span class="op">~</span><span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/make_clean_names.html">make_clean_names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1685900 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): start_station, end_station, bike_number, member_type
dbl  (3): duration, start_station_number, end_station_number
dttm (2): start_date, end_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,685,900 × 9
   duration start_date          end_date            start_stat…¹ start…² end_s…³
      &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;                     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
 1      552 2018-01-01 00:05:06 2018-01-01 00:14:18        31104 Adams …   31400
 2     1282 2018-01-01 00:14:30 2018-01-01 00:35:53        31321 15th S…   31321
 3     1265 2018-01-01 00:14:53 2018-01-01 00:35:58        31321 15th S…   31321
 4      578 2018-01-01 00:15:31 2018-01-01 00:25:09        31406 14th &amp;…   31103
 5      372 2018-01-01 00:18:02 2018-01-01 00:24:15        31618 4th &amp; …   31619
 6      369 2018-01-01 00:18:07 2018-01-01 00:24:17        31618 4th &amp; …   31619
 7      486 2018-01-01 00:19:07 2018-01-01 00:27:14        31042 Market…   31098
 8     1615 2018-01-01 00:21:55 2018-01-01 00:48:50        31042 Market…   31045
 9     1598 2018-01-01 00:22:02 2018-01-01 00:48:41        31042 Market…   31045
10      483 2018-01-01 00:22:10 2018-01-01 00:30:14        31115 Columb…   31509
# … with 1,685,890 more rows, 3 more variables: end_station &lt;chr&gt;,
#   bike_number &lt;chr&gt;, member_type &lt;chr&gt;, and abbreviated variable names
#   ¹​start_station_number, ²​start_station, ³​end_station_number
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<section id="benchmark" class="level2"><h2 class="anchored" data-anchor-id="benchmark">Benchmark</h2>
<p>One advantage of <code>vroom</code> is its speed. In what follows, I will compare different methods to read the <code>files</code> vector that contains 10 files. I will also use the <code>furrr</code> package to use map in parallel.</p>
<div class="cell" data-hash="index_cache/html/benchmark1_aa01c313121467d00496cef3f70d452e">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many cores to use</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/multiprocess.html">multiprocess</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html">availableCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">read_csv</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">fread</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">vroom</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">read_csv</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">fread</span><span class="op">)</span>, </span>
<span>  times <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/benchmark1-1.svg" class="img-fluid" width="672"></p>
</div>
</div>
<p>As we can see, the <code>vroom</code> package is the winner. It is even considerably faster than the versions using map in parallel, which surprises me! Please leave a message below if you have an explanation.</p>
</section><section id="using-altrep" class="level2"><h2 class="anchored" data-anchor-id="using-altrep">Using Altrep</h2>
<p>Another feature of the <code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom()</a></code> function is that we can decide which column types are using Altrep. Setting <code>altrep_opts = TRUE</code> will enable Altrep for all column types. As seen below, this increases further the speed of the <code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom()</a></code> function.</p>
<div class="cell" data-hash="index_cache/html/benchmark2_b179fb7ce8decd1d744d83e63085895c">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="va">files</span>, altrep_opts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `altrep_opts` argument of `vroom()` is deprecated as of vroom 1.1.0.
Please use the `altrep` argument instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/benchmark2-1.svg" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on these results, I think that <code>vroom</code> will become part of my daily workflow from now on.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><script src="https://utteranc.es/client.js" repo="pmassicotte/r-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>